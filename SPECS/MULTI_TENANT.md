# MULTI-TENANT –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

**–ò—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Ä–∞–±–æ—Ç—ã —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∑–∞–∫–∞–∑—á–∏–∫–∞–º–∏.**
**–°–æ–∑–¥–∞–Ω–æ:** 2025-12-07
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2025-12-24

---

## –°–¢–ê–¢–£–° –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å |
|-----------|--------|
| –¢–∞–±–ª–∏—Ü–∞ companies | ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) |
| –¢–∞–±–ª–∏—Ü–∞ clients | ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ |
| –¢–∞–±–ª–∏—Ü–∞ branches | ‚ö†Ô∏è –°–£–©–ï–°–¢–í–£–ï–¢, –ù–ï –ü–û–î–ö–õ–Æ–ß–ï–ù–ê |
| –¢–∞–±–ª–∏—Ü–∞ client_settings | ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ |
| –ü—Ä–æ–º–ø—Ç—ã –∏–∑ –ë–î | ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ |
| RAG —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ client_slug | ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ |
| Telegram –≥—Ä—É–ø–ø—ã –Ω–∞ –∑–∞–∫–∞–∑—á–∏–∫–∞ | ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ |
| –†–æ—É—Ç–∏–Ω–≥ —á–µ—Ä–µ–∑ branch_id | ‚ùå –ù–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û (–ø–ª–∞–Ω) |
| –û–Ω–±–æ—Ä–¥–∏–Ω–≥ —Å–∫—Ä–∏–ø—Ç | ‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û (SQL –≤—Ä—É—á–Ω—É—é) |
| –°—á—ë—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π | üìã –ü–õ–ê–ù |
| Dashboard –¥–ª—è –∑–∞–∫–∞–∑—á–∏–∫–∞ | üìã –ü–õ–ê–ù |

---

# –ß–ê–°–¢–¨ 1: –¢–ï–†–ú–ò–ù–û–õ–û–ì–ò–Ø –ò –ò–ï–†–ê–†–•–ò–Ø

## –ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Ä–º–∏–Ω—ã

| –¢–µ—Ä–º–∏–Ω | –ó–Ω–∞—á–µ–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|--------|----------|--------|
| **Company** | –Æ—Ä. –ª–∏—Ü–æ, –±–∏–ª–ª–∏–Ω–≥ | –¢–û–û "Truffles", –ò–ü "–°–∞–ª–æ–Ω –ú–∏—Ä–∞" |
| **Client** | –ë—Ä–µ–Ω–¥/–ø—Ä–æ–¥—É–∫—Ç –∫–æ–º–ø–∞–Ω–∏–∏ | Truffles (–±–æ—Ç), Demo Salon |
| **Branch** | –§–∏–ª–∏–∞–ª (—Ç–æ—á–∫–∞, –Ω–æ–º–µ—Ä WhatsApp) | –ê–ª–º–∞—Ç—ã, –ê—Å—Ç–∞–Ω–∞ |
| **User** | –ö–æ–Ω–µ—á–Ω—ã–π –∫–ª–∏–µ–Ω—Ç (—á–µ–ª–æ–≤–µ–∫ –≤ WhatsApp) | –ê–Ω–Ω–∞, +7 701 570 5555 |
| **Conversation** | –î–∏–∞–ª–æ–≥ user ‚Üî bot/manager | conversations.id = UUID |

## –ü–æ–ª–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è (–ö–û–ù–ï–ß–ù–û–ï –í–ò–î–ï–ù–ò–ï)

```
Company (–¢–û–û "Truffles") ‚Äî –±–∏–ª–ª–∏–Ω–≥, –≤–ª–∞–¥–µ–ª–µ—Ü
‚îÇ
‚îú‚îÄ‚îÄ Client (Truffles ‚Äî –ø—Ä–æ–¥–∞–∂–∞ –±–æ—Ç–æ–≤)
‚îÇ     ‚îÇ
‚îÇ     ‚îú‚îÄ‚îÄ Branch (–û—Å–Ω–æ–≤–Ω–æ–π)
‚îÇ     ‚îÇ     ‚îú‚îÄ‚îÄ whatsapp: +7 7XX XXX XXXX (instance_id)
‚îÇ     ‚îÇ     ‚îú‚îÄ‚îÄ telegram_chat_id: -100XXXXXXXXXX
‚îÇ     ‚îÇ     ‚îú‚îÄ‚îÄ knowledge_tag: truffles
‚îÇ     ‚îÇ     ‚îÇ
‚îÇ     ‚îÇ     ‚îî‚îÄ‚îÄ Conversations ‚Üí Messages, Handovers
‚îÇ     ‚îÇ
‚îÇ     ‚îî‚îÄ‚îÄ Branch (–ê—Å—Ç–∞–Ω–∞) ‚Äî –±—É–¥—É—â–µ–µ
‚îÇ           ‚îú‚îÄ‚îÄ whatsapp: –¥—Ä—É–≥–æ–π –Ω–æ–º–µ—Ä
‚îÇ           ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îî‚îÄ‚îÄ Client (Demo Salon ‚Äî –¥–µ–º–æ)
      ‚îî‚îÄ‚îÄ Branch (–û—Å–Ω–æ–≤–Ω–æ–π)
            ‚îî‚îÄ‚îÄ ...
```

## –ò–µ—Ä–∞—Ä—Ö–∏—è —Ä–æ–ª–µ–π (–ü–õ–ê–ù)

```
Company
  ‚îî‚îÄ‚îÄ –í–ª–∞–¥–µ–ª–µ—Ü (owner) ‚Äî –≤–∏–¥–∏—Ç –≤—Å—ë, –±–∏–ª–ª–∏–Ω–≥
        ‚îî‚îÄ‚îÄ Client
              ‚îî‚îÄ‚îÄ –ê–¥–º–∏–Ω ‚Äî —É–ø—Ä–∞–≤–ª—è–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–º (–º–æ–∂–µ—Ç –±—ã—Ç—å branch-scoped)
                    ‚îî‚îÄ‚îÄ Branch
                          ‚îî‚îÄ‚îÄ –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å —Ñ–∏–ª–∏–∞–ª–∞
                                ‚îî‚îÄ‚îÄ –ú–µ–Ω–µ–¥–∂–µ—Ä—ã
```

## –¢–µ–∫—É—â–µ–µ vs –ö–æ–Ω–µ—á–Ω–æ–µ

| –ß—Ç–æ | –°–µ–π—á–∞—Å | –ö–æ–Ω–µ—á–Ω–æ–µ |
|-----|--------|----------|
| –†–æ—É—Ç–∏–Ω–≥ | client_id | branch_id |
| Telegram credentials | client_settings | Branch |
| Knowledge | client_slug | Branch.knowledge_tag |
| Conversation –ø—Ä–∏–≤—è–∑–∞–Ω –∫ | client_id | branch_id |
| –ö–∞–Ω–∞–ª—ã (WhatsApp/Instagram) | 1 –Ω–∞ client | —á–µ—Ä–µ–∑ Channel (backlog) |

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤ –ë–î (–¢–ï–ö–£–©–ê–Ø)

```
Company (companies) ‚Äî —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
    ‚îÇ
    ‚îî‚îÄ‚îÄ Client (clients)
          ‚îÇ
          ‚îú‚îÄ‚îÄ ClientSettings (client_settings) ‚Äî telegram, mute, reminders
          ‚îú‚îÄ‚îÄ Prompt (prompts)
          ‚îú‚îÄ‚îÄ Branch (branches) ‚Äî –°–£–©–ï–°–¢–í–£–ï–¢, –ù–ï –ü–û–î–ö–õ–Æ–ß–ï–ù
          ‚îÇ
          ‚îî‚îÄ‚îÄ User (users)
                ‚îÇ
                ‚îî‚îÄ‚îÄ Conversation (conversations)
                        ‚îÇ
                        ‚îú‚îÄ‚îÄ Message (messages)
                        ‚îî‚îÄ‚îÄ Handover (handovers)
```

---

# –ß–ê–°–¢–¨ 2: –ü–†–ò–ù–¶–ò–ü –†–ê–ë–û–¢–´

## –û–¥–∏–Ω API ‚Äî –º–Ω–æ–≥–æ –∑–∞–∫–∞–∑—á–∏–∫–æ–≤

```
–í—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (WhatsApp)
        ‚Üì
ChatFlow –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ API –ø–æ client_slug (–∏–∑ webhook URL)
        ‚Üì
POST /webhook/{client_slug} { body.message, body.metadata.remoteJid, ... }
        ‚Üì
Python API:
  1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç prompt WHERE client_id
  2. –ò—â–µ—Ç –≤ Qdrant WHERE client_slug
  3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Telegram WHERE telegram_chat_id
        ‚Üì
–û—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É —á–µ—Ä–µ–∑ WhatsApp
```

## –ß—Ç–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–æ –ø–æ –∑–∞–∫–∞–∑—á–∏–∫–∞–º

| –î–∞–Ω–Ω—ã–µ | –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è | –ö–∞–∫ —Ä–∞–∑–¥–µ–ª—è–µ—Ç—Å—è |
|--------|--------------|-----------------|
| –ü—Ä–æ–º–ø—Ç | prompts | WHERE client_id |
| –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π | Qdrant | filter: metadata.client_slug + knowledge_tag (branch) |
| –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —ç—Å–∫–∞–ª–∞—Ü–∏–∏ | client_settings | WHERE client_id |
| Telegram –≥—Ä—É–ø–ø–∞ | branches.telegram_chat_id | –û—Ç–¥–µ–ª—å–Ω–∞—è –≥—Ä—É–ø–ø–∞ –Ω–∞ —Ñ–∏–ª–∏–∞–ª |
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ | users | WHERE client_id |
| –î–∏–∞–ª–æ–≥–∏ | conversations | WHERE client_id |
| –°–æ–æ–±—â–µ–Ω–∏—è | messages | —á–µ—Ä–µ–∑ conversation ‚Üí client_id |
| –ó–∞—è–≤–∫–∏ | handovers | WHERE client_id |

## –ß—Ç–æ –æ–±—â–µ–µ –¥–ª—è –≤—Å–µ—Ö

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ü–æ—á–µ–º—É –æ–±—â–∏–π |
|-----------|--------------|
| Python API | –õ–æ–≥–∏–∫–∞ –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è |
| Webhook –≤—Ö–æ–¥ | –†–æ—É—Ç–∏–Ω–≥ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π |
| PostgreSQL | –û–¥–Ω–∞ –ë–î, —Ä–∞–∑–Ω—ã–µ –∑–∞–ø–∏—Å–∏ |
| Qdrant | –û–¥–Ω–∞ –∫–æ–ª–ª–µ–∫—Ü–∏—è, —Ä–∞–∑–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã |
| LLM (OpenAI) | –û–¥–∏–Ω API key |

## Domain Pack / Client Pack (Knowledge)

- **Domain Pack** ‚Äî –æ–±—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É—Å–ª—É–≥, RU/KZ —Å–∏–Ω–æ–Ω–∏–º—ã, —Ç–∏–ø–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã, OOD‚Äë—è–∫–æ—Ä—è. **–ë–µ–∑ —Ñ–∞–∫—Ç–æ–≤.**
- **Client Pack** ‚Äî —Ñ–∞–∫—Ç—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–∞–ª–æ–Ω–∞: —É—Å–ª—É–≥–∏, —Ü–µ–Ω—ã, –∞–¥—Ä–µ—Å, —á–∞—Å—ã, –ø—Ä–∞–≤–∏–ª–∞, –∞–∫—Ü–∏–∏ –∏ —Ç.–¥.
- **demo_salon** ‚Äî dummy Client Pack, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–µ–º–æ/—Ç–µ—Å—Ç–æ–≤.

**–ì–¥–µ –ª–µ–∂–∏—Ç:** `truffles-api/app/knowledge/<client_slug>/SALON_TRUTH.yaml`  
**–§–æ—Ä–º–∞—Ç:** `domain_pack` + `client_pack`, –ø—Ä–∏ —ç—Ç–æ–º —Å—Ç–∞—Ä—ã–µ –∫–ª—é—á–∏ –æ—Å—Ç–∞—é—Ç—Å—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

---

# –ß–ê–°–¢–¨ 3: –°–¢–†–£–ö–¢–£–†–ê –î–ê–ù–ù–´–•

## –¢–∞–±–ª–∏—Ü–∞ clients [–°–£–©–ï–°–¢–í–£–ï–¢]

```sql
CREATE TABLE clients (
    id          UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name        TEXT NOT NULL,              -- "–°–∞–ª–æ–Ω –ú–∏—Ä–∞"
    slug        TEXT UNIQUE NOT NULL,       -- "demo_salon"
    status      TEXT DEFAULT 'active',      -- active, suspended, deleted
    config      JSONB,                      -- –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    created_at  TIMESTAMP DEFAULT NOW()
);
```

**–°—Ç–∞—Ç—É—Å—ã:**
- `active` ‚Äî –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
- `suspended` ‚Äî –±–æ—Ç –º–æ–ª—á–∏—Ç (–Ω–µ –æ–ø–ª–∞—Ç–∏–ª)
- `deleted` ‚Äî –∑–∞–∫–∞–∑—á–∏–∫ —É—à—ë–ª

## –¢–∞–±–ª–∏—Ü–∞ client_settings [–°–£–©–ï–°–¢–í–£–ï–¢]

```sql
CREATE TABLE client_settings (
    client_id                   UUID PRIMARY KEY REFERENCES clients(id),
    
    -- Telegram
    telegram_chat_id            TEXT,       -- "-1003362579990"
    telegram_bot_token          TEXT,       -- "8045341599:AAGY..."
    owner_telegram_id           TEXT,       -- "@ent3rprise"
    
    -- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
    reminder_timeout_1          INT DEFAULT 30,   -- –º–∏–Ω—É—Ç
    reminder_timeout_2          INT DEFAULT 60,   -- –º–∏–Ω—É—Ç
    enable_reminders            BOOLEAN DEFAULT TRUE,
    enable_owner_escalation     BOOLEAN DEFAULT TRUE,
    
    -- –ú—å—é—Ç
    mute_duration_first_minutes INT DEFAULT 30,
    mute_duration_second_hours  INT DEFAULT 24
);
```

## –¢–∞–±–ª–∏—Ü–∞ prompts [–°–£–©–ï–°–¢–í–£–ï–¢]

```sql
CREATE TABLE prompts (
    id          UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    client_id   UUID REFERENCES clients(id),
    name        TEXT NOT NULL,              -- "system"
    text        TEXT NOT NULL,              -- —Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞
    model       TEXT,                       -- "gpt-4o-mini"
    temperature NUMERIC,                    -- 1.0
    is_active   BOOLEAN DEFAULT TRUE,
    created_at  TIMESTAMP DEFAULT NOW()
);
```

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
```python
# ai_service.py
def get_system_prompt(db, client_id):
    prompt = db.query(Prompt).filter(
        Prompt.client_id == client_id,
        Prompt.name == "system",
        Prompt.is_active == True
    ).first()
    return prompt.text if prompt else DEFAULT_PROMPT
```

## Qdrant ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞

```json
{
  "id": "uuid",
  "vector": [0.1, 0.2, ...],
  "payload": {
    "content": "–¢–µ–∫—Å—Ç —á–∞–Ω–∫–∞",
    "metadata": {
      "client_slug": "demo_salon",    // ‚Üê —Ñ–∏–ª—å—Ç—Ä
      "doc_name": "services.md",
      "source": "document"
    }
  }
}
```

**–ö–∞–∫ –∏—â–µ—Ç—Å—è:**
```python
# knowledge_service.py
def search_knowledge(query, client_slug, limit=5):
    return qdrant.search(
        filter={"must": [
            {"key": "metadata.client_slug", "match": {"value": client_slug}}
        ]},
        ...
    )
```

---

# –ß–ê–°–¢–¨ 4: –¢–ï–ö–£–©–ò–ï –ó–ê–ö–ê–ó–ß–ò–ö–ò

## –ê–∫—Ç–∏–≤–Ω—ã–µ

| name | slug | client_id | telegram_chat_id | –°—Ç–∞—Ç—É—Å |
|------|------|-----------|------------------|--------|
| Truffles | truffles | 499e4744-5e7f-4a97-8466-56ff2cdcf587 | -1003362579990 | –¢–µ—Å—Ç (–º—ã) |
| Demo Salon | demo_salon | <CLIENT_ID> | -1003412216010 | –î–µ–º–æ |

## Telegram –±–æ—Ç—ã

| –ó–∞–∫–∞–∑—á–∏–∫ | Bot username | –î–ª—è —á–µ–≥–æ |
|----------|--------------|----------|
| truffles | @truffles_kz_bot | –≠—Å–∫–∞–ª–∞—Ü–∏–∏ Truffles |
| demo_salon | @salon_mira_bot | –≠—Å–∫–∞–ª–∞—Ü–∏–∏ —Å–∞–ª–æ–Ω–∞ |

---

# –ß–ê–°–¢–¨ 5: –û–ù–ë–û–†–î–ò–ù–ì –ó–ê–ö–ê–ó–ß–ò–ö–ê

## –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑—á–∏–∫–∞

| –®–∞–≥ | –ß—Ç–æ –¥–µ–ª–∞–µ–º | –ì–¥–µ |
|-----|------------|-----|
| 1 | –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ clients | PostgreSQL |
| 2 | –°–æ–∑–¥–∞—Ç—å client_settings | PostgreSQL |
| 3 | –°–æ–∑–¥–∞—Ç—å Telegram –≥—Ä—É–ø–ø—É | Telegram |
| 4 | –î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É | Telegram |
| 5 | –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–ø—Ç | PostgreSQL |
| 6 | –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π | Markdown —Ñ–∞–π–ª—ã |
| 7 | –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ Qdrant | Knowledge Sync |
| 8 | –ù–∞—Å—Ç—Ä–æ–∏—Ç—å ChatFlow | ChatFlow UI |
| 9 | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | WhatsApp |

## –®–∞–≥ 1-2: –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å–∏ –≤ –ë–î

```sql
-- 1. –°–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
INSERT INTO clients (name, slug, status)
VALUES ('–°–∞–ª–æ–Ω –ö—Ä–∞—Å–æ—Ç—ã "–≠–ª–∏—Ç–∞"', 'salon_elita', 'active')
RETURNING id;

-- –ü–æ–ª—É—á–∞–µ–º: client_id = '–Ω–æ–≤—ã–π-uuid'

-- 2. –°–æ–∑–¥–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
INSERT INTO client_settings (
    client_id,
    telegram_chat_id,
    telegram_bot_token,
    owner_telegram_id
) VALUES (
    '–Ω–æ–≤—ã–π-uuid',
    '-100XXXXXXXXXX',      -- ID –≥—Ä—É–ø–ø—ã –≤ Telegram
    'BOT_TOKEN',           -- —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
    '@owner_username'      -- username –≤–ª–∞–¥–µ–ª—å—Ü–∞
);
```

## –®–∞–≥ 3-4: Telegram –≥—Ä—É–ø–ø–∞

1. –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É –≤ Telegram
2. –í–∫–ª—é—á–∏—Ç—å Topics (–¢–µ–º—ã)
3. –î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ (@truffles_kz_bot –∏–ª–∏ –Ω–æ–≤—ã–π)
4. –°–¥–µ–ª–∞—Ç—å –±–æ—Ç–∞ –∞–¥–º–∏–Ω–æ–º —Å –ø—Ä–∞–≤–∞–º–∏:
   - Manage Topics
   - Pin Messages
   - Send Messages
5. –ü–æ–ª—É—á–∏—Ç—å chat_id: –¥–æ–±–∞–≤–∏—Ç—å @getidsbot, –æ–Ω –ø–æ–∫–∞–∂–µ—Ç ID

## –®–∞–≥ 5: –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–ø—Ç

```sql
INSERT INTO prompts (client_id, name, text, is_active)
VALUES (
    '–Ω–æ–≤—ã–π-uuid',
    'system',
    '–¢—ã ‚Äî –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç —Å–∞–ª–æ–Ω–∞ –∫—Ä–∞—Å–æ—Ç—ã "–≠–ª–∏—Ç–∞".

–ü–†–ê–í–ò–õ–ê:
1. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ: 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
2. –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
3. –ï—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—à—å ‚Äî —Å–∫–∞–∂–∏ "–£—Ç–æ—á–Ω—é —É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"
4. –ù–µ –≤—ã–¥—É–º—ã–≤–∞–π —Ü–µ–Ω—ã –∏ —É—Å–ª—É–≥–∏
5. –ù–µ –¥–∞–≤–∞–π —Å–∫–∏–¥–∫–∏

–ö–û–ù–¢–ê–ö–¢: +7 777 123 4567',
    TRUE
);
```

## –®–∞–≥ 6-7: –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π

### –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ñ–∞–π–ª—ã

```
knowledge/
‚îú‚îÄ‚îÄ salon_elita/
‚îÇ   ‚îú‚îÄ‚îÄ services.md      -- —É—Å–ª—É–≥–∏ –∏ —Ü–µ–Ω—ã
‚îÇ   ‚îú‚îÄ‚îÄ faq.md           -- —á–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ rules.md         -- –ø—Ä–∞–≤–∏–ª–∞ –∑–∞–ø–∏—Å–∏
‚îÇ   ‚îî‚îÄ‚îÄ objections.md    -- —Ä–∞–±–æ—Ç–∞ —Å –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è–º–∏
```

### –§–æ—Ä–º–∞—Ç services.md

```markdown
# –£—Å–ª—É–≥–∏ —Å–∞–ª–æ–Ω–∞ "–≠–ª–∏—Ç–∞"

## –ú–∞–Ω–∏–∫—é—Ä

### –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –º–∞–Ω–∏–∫—é—Ä
- –¶–µ–Ω–∞: 3,500 —Ç–≥
- –í—Ä–µ–º—è: 45 –º–∏–Ω—É—Ç
- –û–ø–∏—Å–∞–Ω–∏–µ: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫—É—Ç–∏–∫—É–ª—ã, –ø—Ä–∏–¥–∞–Ω–∏–µ —Ñ–æ—Ä–º—ã –Ω–æ–≥—Ç—è–º

### –ú–∞–Ω–∏–∫—é—Ä —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –≥–µ–ª—å-–ª–∞–∫
- –¶–µ–Ω–∞: 6,000 —Ç–≥
- –í—Ä–µ–º—è: 1.5 —á–∞—Å–∞
- –û–ø–∏—Å–∞–Ω–∏–µ: –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –º–∞–Ω–∏–∫—é—Ä + –ø–æ–∫—Ä—ã—Ç–∏–µ –≥–µ–ª—å-–ª–∞–∫–æ–º

## –ü–µ–¥–∏–∫—é—Ä
...
```

### –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ Qdrant

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd ~/truffles/ops
python3 sync_client.py salon_elita ./knowledge/salon_elita/
```

–ò–ª–∏ —á–µ—Ä–µ–∑ —Ä—É—á–Ω–æ–π sync workflow (—Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫).

## –®–∞–≥ 8: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å ChatFlow

1. –ó–∞–π—Ç–∏ –≤ ChatFlow
2. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–º–µ—Ä WhatsApp –∑–∞–∫–∞–∑—á–∏–∫–∞
3. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å webhook secret (32+ —Å–∏–º–≤–æ–ª–æ–≤) –∏ –∑–∞–ø–∏—Å–∞—Ç—å –≤ `client_settings.webhook_secret`
   - –ü—Ä–∏–º–µ—Ä (SQL): `UPDATE client_settings SET webhook_secret = '<SECRET>' WHERE client_id = '<CLIENT_ID>';`
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook:
   ```
   URL: https://api.truffles.kz/webhook/salon_elita?webhook_secret=<SECRET>
   ```
5. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –≤–º–µ—Å—Ç–æ query –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å header `X-Webhook-Secret: <SECRET>`
6. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å

## –®–∞–≥ 9: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ù–∞–ø–∏—Å–∞—Ç—å —Å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –Ω–æ–º–µ—Ä–∞ –≤ WhatsApp –∑–∞–∫–∞–∑—á–∏–∫–∞
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
   - [ ] –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç
   - [ ] –û—Ç–≤–µ—Ç –∏–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
   - [ ] –≠—Å–∫–∞–ª–∞—Ü–∏—è –∏–¥—ë—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é Telegram –≥—Ä—É–ø–ø—É
   - [ ] –ö–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
   - [ ] –û—Ç–≤–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –∫–ª–∏–µ–Ω—Ç–∞

---

# –ß–ê–°–¢–¨ 6: –í–û–ü–†–û–°–´ –ò –†–ï–®–ï–ù–ò–Ø

## –†–µ—à—ë–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### 1. –ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å client_id –ø–æ –≤—Ö–æ–¥—è—â–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é?

**–†–µ—à–µ–Ω–∏–µ:** webhook URL —Å–æ–¥–µ—Ä–∂–∏—Ç client_slug (–ø—Ä—è–º–æ–π –≤—Ö–æ–¥ –≤ API).

```
https://api.truffles.kz/webhook/salon_elita?webhook_secret=...
                                 ‚Üë
                           client_slug
```

API –∏–∑–≤–ª–µ–∫–∞–µ—Ç slug ‚Üí –∏—â–µ—Ç –≤ –ë–î ‚Üí –ø–æ–ª—É—á–∞–µ—Ç client_id.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è (preferred):** ChatFlow ‚Üí Python API (`/webhook/{client_slug}`).
**Legacy:** webhook wrapper ‚Üí Python API (`/webhook`).

---

### 2. –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π ‚Äî –∫–∞–∫ —Ä–∞–∑–¥–µ–ª—è—Ç—å?

**–†–µ—à–µ–Ω–∏–µ:** –û–¥–Ω–∞ –∫–æ–ª–ª–µ–∫—Ü–∏—è Qdrant, —Ñ–∏–ª—å—Ç—Ä –ø–æ `metadata.client_slug`.

```python
filter={"must": [
    {"key": "metadata.client_slug", "match": {"value": "salon_elita"}}
]}
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `knowledge_service.py`.

---

### 3. –≠—Å–∫–∞–ª–∞—Ü–∏—è ‚Äî –∫—É–¥–∞ —Å–ª–∞—Ç—å?

**–†–µ—à–µ–Ω–∏–µ:** –û—Ç–¥–µ–ª—å–Ω–∞—è Telegram –≥—Ä—É–ø–ø–∞ –Ω–∞ –∑–∞–∫–∞–∑—á–∏–∫–∞.

- `client_settings.telegram_chat_id` ‚Äî ID –≥—Ä—É–ø–ø—ã
- `client_settings.telegram_bot_token` ‚Äî —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
- –¢–æ–ø–∏–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `escalation_service.py`.

---

### 4. –ß—Ç–æ –µ—Å–ª–∏ –∑–∞–∫–∞–∑—á–∏–∫ –Ω–µ –æ–ø–ª–∞—Ç–∏–ª?

**–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–∏—Ç—å `clients.status = 'suspended'`.

```python
# message.py ‚Äî –≤ –Ω–∞—á–∞–ª–µ
if client.status != 'active':
    return {"success": False, "message": "Client suspended"}
```

–ë–æ—Ç –ø—Ä–æ—Å—Ç–æ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç. –ö–ª–∏–µ–Ω—Ç –≤–∏–¥–∏—Ç —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ, –Ω–æ –æ—Ç–≤–µ—Ç–∞ –Ω–µ—Ç.

**TODO:** –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑—á–∏–∫—É —á—Ç–æ –±–æ—Ç –æ—Ç–∫–ª—é—á–µ–Ω.

---

### 5. –ü—Ä–æ–º–ø—Ç ‚Äî –∫—Ç–æ –ø–∏—à–µ—Ç?

**–†–µ—à–µ–Ω–∏–µ:** –ñ–∞–Ω–±–æ–ª –ø–∏—à–µ—Ç –±–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —à–∞–±–ª–æ–Ω–∞.

–®–∞–±–ª–æ–Ω:
```
–¢—ã ‚Äî –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç [–ù–ê–ó–í–ê–ù–ò–ï].

–ü–†–ê–í–ò–õ–ê:
1. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ: 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
2. –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
3. –ï—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—à—å ‚Äî —Å–∫–∞–∂–∏ "–£—Ç–æ—á–Ω—é —É [–†–û–õ–¨]"
4. –ù–µ –≤—ã–¥—É–º—ã–≤–∞–π —Ü–µ–Ω—ã –∏ —É—Å–ª—É–≥–∏
5. –ù–µ –¥–∞–≤–∞–π —Å–∫–∏–¥–∫–∏

–ö–û–ù–¢–ê–ö–¢: [–¢–ï–õ–ï–§–û–ù]
```

–ó–∞–∫–∞–∑—á–∏–∫ –º–æ–∂–µ—Ç –ø–æ–ø—Ä–æ—Å–∏—Ç—å –∏–∑–º–µ–Ω–∏—Ç—å —Ç–æ–Ω, –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞.

---

### 6. –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç 24/7?

**–†–µ—à–µ–Ω–∏–µ:** –î–∞, –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç 24/7. –≠—Ç–æ selling point.

Quiet hours ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º (–ø–ª–∞–Ω P2).

---

### 7. –û—à–∏–±–∫–∏ ‚Äî —á—Ç–æ –æ—Ç–≤–µ—á–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—É?

**–†–µ—à–µ–Ω–∏–µ:** Fallback —Å–æ–æ–±—â–µ–Ω–∏–µ + —ç—Å–∫–∞–ª–∞—Ü–∏—è.

```python
except Exception as e:
    bot_response = "–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏."
    escalate_with_reason("error", str(e))
```

---

### 8. Active Learning ‚Äî –∫—Ç–æ –º–æ–¥–µ—Ä–∏—Ä—É–µ—Ç?

**–†–µ—à–µ–Ω–∏–µ:** –ö–∞–∂–¥—ã–π owner –º–æ–¥–µ—Ä–∏—Ä—É–µ—Ç —Å–≤–æ–∏—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤.

- Owner –æ—Ç–≤–µ—Ç–∏–ª ‚Üí —Å—Ä–∞–∑—É –≤ –±–∞–∑—É (–∞–≤—Ç–æ–º–æ–¥–µ—Ä–∞—Ü–∏—è)
- –ê–¥–º–∏–Ω –æ—Ç–≤–µ—Ç–∏–ª ‚Üí pending (–∏–ª–∏ auto-approve, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ –¥–ª—è branch)
- –ú–µ–Ω–µ–¥–∂–µ—Ä –æ—Ç–≤–µ—Ç–∏–ª ‚Üí owner –ø–æ–ª—É—á–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ [–í –±–∞–∑—É] [–û—Ç–∫–ª–æ–Ω–∏—Ç—å]

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –ü–ª–∞–Ω P2 (ACTIVE_LEARNING.md).

---

### 9. –ù–µ—Å–∫–æ–ª—å–∫–æ –Ω–æ–º–µ—Ä–æ–≤ —É –æ–¥–Ω–æ–≥–æ –∑–∞–∫–∞–∑—á–∏–∫–∞?

**–†–µ—à–µ–Ω–∏–µ:** –ß–µ—Ä–µ–∑ Branch (—Ñ–∏–ª–∏–∞–ª—ã), —Ä–µ–∂–∏–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥–æ–º.

**–ß—Ç–æ –µ—Å—Ç—å:**
- –¢–∞–±–ª–∏—Ü–∞ `branches` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ü–æ–ª—è: instance_id, telegram_chat_id, knowledge_tag

**–†–µ–∂–∏–º—ã (config):**
- `by_instance`: –µ—Å–ª–∏ —É —Ñ–∏–ª–∏–∞–ª–æ–≤ —Ä–∞–∑–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ ‚Üí branch –ø–æ instance_id
- `ask_user`: –µ—Å–ª–∏ –Ω–æ–º–µ—Ä –æ–¥–∏–Ω ‚Üí –±–æ—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ñ–∏–ª–∏–∞–ª
- `hybrid`: –µ—Å–ª–∏ instance_id –∏–∑–≤–µ—Å—Ç–µ–Ω ‚Üí branch, –∏–Ω–∞—á–µ —Å–ø—Ä–∞—à–∏–≤–∞–µ–º
 - `manager_scope`: `branch` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) –∏–ª–∏ `global`

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å (–≤ –ø–ª–∞–Ω–µ):**
- [ ] Conversation.branch_id –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
- [ ] –†–æ—É—Ç–∏–Ω–≥ –ø–æ instance_id ‚Üí branch (by_instance/hybrid)
- [ ] –í–µ—Ç–∫–∞ ‚Äú—Å–ø—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª–∏–∞–ª‚Äù (ask_user/hybrid)
- [ ] –≠—Å–∫–∞–ª–∞—Ü–∏—è –∏–∑ Branch.telegram_chat_id
- [ ] RAG —Ñ–∏–ª—å—Ç—Ä –ø–æ Branch.knowledge_tag
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (optional)

**–°—Ç–∞—Ç—É—Å:** –í –¢–ï–ö–£–©–ï–ú –ü–õ–ê–ù–ï (STATE.md).

---

## –û—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### 10. –°—á—ë—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –ª–∏–º–∏—Ç—ã

**–°—Ç–∞—Ç—É—Å:** –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ.

**–ü–ª–∞–Ω:**
```sql
CREATE TABLE usage (
    client_id    UUID REFERENCES clients(id),
    month        DATE,
    messages_in  INT DEFAULT 0,
    PRIMARY KEY (client_id, month)
);

-- –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤—Ö–æ–¥—è—â–µ–≥–æ
UPDATE usage 
SET messages_in = messages_in + 1 
WHERE client_id = ? AND month = date_trunc('month', NOW());
```

**–õ–æ–≥–∏–∫–∞:**
- 80% –ª–∏–º–∏—Ç–∞ ‚Üí –∞–ª–µ—Ä—Ç –∑–∞–∫–∞–∑—á–∏–∫—É
- 100% ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –¥–æ–ø–ª–∞—Ç–∞ –∏–ª–∏ –ø–∞—É–∑–∞

---

### 11. –ó–∞–∫–∞–∑—á–∏–∫ —É—à—ë–ª ‚Äî —á—Ç–æ —Å –¥–∞–Ω–Ω—ã–º–∏?

**–°—Ç–∞—Ç—É—Å:** –ù–µ —Ä–µ—à–µ–Ω–æ.

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**
1. –£–¥–∞–ª—è—Ç—å –≤—Å—ë (GDPR compliant)
2. –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ N –º–µ—Å—è—Ü–µ–≤
3. –û—Å—Ç–∞–≤–ª—è—Ç—å –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (–∞–Ω–æ–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å 6 –º–µ—Å—è—Ü–µ–≤, –ø–æ—Ç–æ–º —É–¥–∞–ª—è—Ç—å.

---

### 12. Dashboard –¥–ª—è –∑–∞–∫–∞–∑—á–∏–∫–∞

**–°—Ç–∞—Ç—É—Å:** –ü–ª–∞–Ω P2-P3.

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç—Å–∫–∞–ª–∞—Ü–∏–π
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
- –¢–æ–ø –≤–æ–ø—Ä–æ—Å–æ–≤

---

### 13. –Ø–∑—ã–∫ (–∫–∞–∑–∞—Ö—Å–∫–∏–π/—Ä—É—Å—Å–∫–∏–π)

**–°—Ç–∞—Ç—É—Å:** –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.

LLM —Å–∞–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —è–∑—ã–∫ –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –Ω—ë–º. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–µ –Ω—É–∂–Ω–∞.

---

### 14. –í–µ—Ä—Å–∏–∏ –ø—Ä–æ–º–ø—Ç–æ–≤

**–°—Ç–∞—Ç—É—Å:** –ù–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.

–í prompts –µ—Å—Ç—å is_active. –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –∏ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π.

–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚Äî —á–µ—Ä–µ–∑ git (–ø—Ä–æ–º–ø—Ç—ã –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö) –∏–ª–∏ audit log (–ø–æ—Ç–æ–º).

---

# –ß–ê–°–¢–¨ 7: –¶–ï–ù–û–û–ë–†–ê–ó–û–í–ê–ù–ò–ï

## –¢–µ–∫—É—â–∏–µ —Ç–∞—Ä–∏—Ñ—ã

| –¢–∞—Ä–∏—Ñ | –¶–µ–Ω–∞ | –õ–∏–º–∏—Ç | –°—Ç–∞—Ç—É—Å |
|-------|------|-------|--------|
| Starter | 50,000 ‚Ç∏/–º–µ—Å | 1000 —Å–æ–æ–±—â–µ–Ω–∏–π | ‚úÖ –ü—Ä–æ–¥–∞—ë–º |
| Medium | 100,000 ‚Ç∏/–º–µ—Å | 3000 —Å–æ–æ–±—â–µ–Ω–∏–π | üìã –ü–ª–∞–Ω |
| Pro | 150,000 ‚Ç∏/–º–µ—Å | –ë–µ–∑–ª–∏–º–∏—Ç | üìã –ü–ª–∞–Ω |

## –ß—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ Starter

- –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç 24/7
- –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –¥–æ 50 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –≠—Å–∫–∞–ª–∞—Ü–∏—è –≤ Telegram
- 1 –Ω–æ–º–µ—Ä WhatsApp

## –ß—Ç–æ –ù–ï –≤—Ö–æ–¥–∏—Ç

- Dashboard (–±—É–¥–µ—Ç –≤ Medium)
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (–±—É–¥–µ—Ç –≤ Medium)
- Kaspi Pay –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–Ω–µ –æ–±–µ—â–∞–µ–º)
- CRM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–Ω–µ –æ–±–µ—â–∞–µ–º)

## –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ 1000 —Å–æ–æ–±—â–µ–Ω–∏–π

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–æ–∏–º–æ—Å—Ç—å |
|-----------|-----------|
| LLM (OpenAI) | ~$2.00 (~900 ‚Ç∏) |
| –°–µ—Ä–≤–µ—Ä (–¥–æ–ª—è) | ~$5.00 (~2,200 ‚Ç∏) |
| WhatsApp (ChatFlow) | ~$10.00 (~4,500 ‚Ç∏) |
| **–ò—Ç–æ–≥–æ** | **~7,600 ‚Ç∏** |

**–ú–∞—Ä–∂–∞ Starter:** ~85%

---

# –ß–ê–°–¢–¨ 8: –ß–ï–ö–õ–ò–°–¢ –û–ù–ë–û–†–î–ò–ù–ì–ê

## –ß–µ–∫–ª–∏—Å—Ç –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–µ (35 –º–∏–Ω—É—Ç)

> –ò—Å—Ç–æ—á–Ω–∏–∫: `STRATEGY/MARKET.md`, `.archive/research/NORTH_STAR.md`

### –ë–ª–æ–∫ 1: –û –∫–æ–º–ø–∞–Ω–∏–∏ (5 –º–∏–Ω)
```
‚ñ° –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
‚ñ° –ß–µ–º –∑–∞–Ω–∏–º–∞–µ—Ç–µ—Å—å? (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
‚ñ° –ö—Ç–æ —Ç–∏–ø–∏—á–Ω—ã–π –∫–ª–∏–µ–Ω—Ç?
‚ñ° –°—Ä–µ–¥–Ω–∏–π —á–µ–∫
‚ñ° –°–∫–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ –¥–µ–Ω—å/–Ω–µ–¥–µ–ª—é?
```

### –ë–ª–æ–∫ 2: –ü—Ä–æ–¥–∞–∂–∏ (10 –º–∏–Ω)
```
‚ñ° –ö–∞–∫ —Å–µ–π—á–∞—Å –ø—Ä–æ–¥–∞—ë—Ç–µ? (WhatsApp/–∑–≤–æ–Ω–∫–∏/–æ—Ñ–ª–∞–π–Ω)
‚ñ° –ö—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞–º?
‚ñ° –¢–û–ü-5 —á–∞—Å—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
‚ñ° –¢–û–ü-3 –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è ("–¥–æ—Ä–æ–≥–æ", "–ø–æ–¥—É–º–∞—é"...)
‚ñ° –ö–∞–∫ –æ—Ç–≤–µ—á–∞–µ—Ç–µ –Ω–∞ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è?
‚ñ° –ï—Å—Ç—å –≥–æ—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã?
```

### –ë–ª–æ–∫ 3: –ü—Ä–æ—Ü–µ—Å—Å—ã (5 –º–∏–Ω)
```
‚ñ° –ö–∞–∫ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç–µ –∫–ª–∏–µ–Ω—Ç–æ–≤? (CRM/—Ç–µ—Ç—Ä–∞–¥–∫–∞)
‚ñ° –ö–∞–∫ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ –æ–ø–ª–∞—Ç—É? (Kaspi/–Ω–∞–ª–∏—á–∫–∞)
‚ñ° –ö—Ç–æ —Ä–µ—à–∞–µ—Ç –ø–æ —Å–∫–∏–¥–∫–∞–º?
‚ñ° –ö—É–¥–∞ —Å–ª–∞—Ç—å —ç—Å–∫–∞–ª–∞—Ü–∏–∏? (WhatsApp/Telegram –≥—Ä—É–ø–ø–∞)
```

### –ë–ª–æ–∫ 4: –ö–æ–Ω—Ç–µ–Ω—Ç (10 –º–∏–Ω)
```
‚ñ° –ï—Å—Ç—å –ø—Ä–∞–π—Å-–ª–∏—Å—Ç?
‚ñ° –ï—Å—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥?
‚ñ° –ï—Å—Ç—å –æ—Ç–∑—ã–≤—ã/–∫–µ–π—Å—ã?
‚ñ° –ï—Å—Ç—å —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ?
‚ñ° –ß—Ç–æ –±–æ—Ç –ù–ï –¥–æ–ª–∂–µ–Ω –≥–æ–≤–æ—Ä–∏—Ç—å?
```

### –ë–ª–æ–∫ 5: –û–∂–∏–¥–∞–Ω–∏—è (5 –º–∏–Ω)
```
‚ñ° –ß—Ç–æ –¥–ª—è –≤–∞—Å —É—Å–ø–µ—Ö —á–µ—Ä–µ–∑ –º–µ—Å—è—Ü?
‚ñ° –ß—Ç–æ –±–æ—Ç —Ç–æ—á–Ω–æ –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å?
‚ñ° –ß—Ç–æ –±–æ—Ç —Ç–æ—á–Ω–æ –ù–ï –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å?
‚ñ° –ì–æ—Ç–æ–≤—ã –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ —ç—Å–∫–∞–ª–∞—Ü–∏–∏ –∑–∞ 10 –º–∏–Ω—É—Ç?
```

---

## –ü–µ—Ä–µ–¥ –≤—Å—Ç—Ä–µ—á–µ–π —Å –∑–∞–∫–∞–∑—á–∏–∫–æ–º

- [ ] –ë—Ä–∏—Ñ –∑–∞–ø–æ–ª–Ω–µ–Ω (—É—Å–ª—É–≥–∏, —Ü–µ–Ω—ã, –∫–æ–Ω—Ç–∞–∫—Ç—ã)
- [ ] –î–æ–≥–æ–≤–æ—Ä –≥–æ—Ç–æ–≤
- [ ] –ü–æ–Ω—è—Ç–Ω–æ –∫—Ç–æ owner, –∫—Ç–æ –º–µ–Ω–µ–¥–∂–µ—Ä—ã

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

- [ ] –ó–∞–ø–∏—Å—å –≤ clients
- [ ] –ó–∞–ø–∏—Å—å –≤ client_settings
- [ ] Telegram –≥—Ä—É–ø–ø–∞ —Å–æ–∑–¥–∞–Ω–∞
- [ ] –ë–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É
- [ ] –ü—Ä–æ–º–ø—Ç –Ω–∞–ø–∏—Å–∞–Ω
- [ ] –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞
- [ ] –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –≤ Qdrant
- [ ] ChatFlow –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Webhook —Ä–∞–±–æ—Ç–∞–µ—Ç

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- [ ] –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –ø—Ä–æ—Å—Ç–æ–π –≤–æ–ø—Ä–æ—Å
- [ ] –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç "–Ω–µ –∑–Ω–∞—é" –Ω–∞ —Å–ª–æ–∂–Ω—ã–π
- [ ] –≠—Å–∫–∞–ª–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ö–Ω–æ–ø–∫–∏ [–ë–µ—Ä—É] [–†–µ—à–µ–Ω–æ] —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –û—Ç–≤–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –∫–ª–∏–µ–Ω—Ç–∞
- [ ] –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç

## –ü–µ—Ä–µ–¥–∞—á–∞ –∑–∞–∫–∞–∑—á–∏–∫—É

- [ ] –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è Telegram –≥—Ä—É–ø–ø–æ–π
- [ ] –û–±—ä—è—Å–Ω–∏—Ç—å –∫–Ω–æ–ø–∫–∏
- [ ] –î–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è –æ –∫–æ–Ω—Ç–∞–∫—Ç–µ –¥–ª—è –ø—Ä–æ–±–ª–µ–º
- [ ] –ü–µ—Ä–≤–∞—è –æ–ø–ª–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∞

---

# –ß–ê–°–¢–¨ 9: –ò–ó–í–ï–°–¢–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

| –ü—Ä–æ–±–ª–µ–º–∞ | –í–ª–∏—è–Ω–∏–µ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|---------|
| –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ | –ö–∞–∂–¥—ã–π –∫–ª–∏–µ–Ω—Ç –≤—Ä—É—á–Ω—É—é | –°–∫—Ä–∏–ø—Ç –∏–ª–∏ UI (P2) |
| –ù–µ—Ç —Å—á—ë—Ç—á–∏–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π | –ù–µ –∑–Ω–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ | –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å (P2) |
| –ù–µ—Ç dashboard | –ó–∞–∫–∞–∑—á–∏–∫ –Ω–µ –≤–∏–¥–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É | –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å (P3) |
| –û–¥–∏–Ω –±–æ—Ç –Ω–∞ –≤—Å–µ—Ö | –í—Å–µ —ç—Å–∫–∞–ª–∞—Ü–∏–∏ –æ—Ç –æ–¥–Ω–æ–≥–æ –±–æ—Ç–∞ | –û—Ç–¥–µ–ª—å–Ω—ã–π –±–æ—Ç –Ω–∞ –∫—Ä—É–ø–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |

---

## –°–í–Ø–ó–¨ –° –î–†–£–ì–ò–ú–ò –î–û–ö–£–ú–ï–ù–¢–ê–ú–ò

| –î–æ–∫—É–º–µ–Ω—Ç | –ß—Ç–æ —Ç–∞–º |
|----------|---------|
| `SPECS/ARCHITECTURE.md` | –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ |
| `SPECS/ESCALATION.md` | –õ–æ–≥–∏–∫–∞ —ç—Å–∫–∞–ª–∞—Ü–∏–∏ |
| `TECH.md` | –î–æ—Å—Ç—É–ø—ã, –∫–æ–º–∞–Ω–¥—ã |
| `STRATEGY/PRODUCT.md` | –¢–∞—Ä–∏—Ñ—ã, roadmap |

---

*–°–æ–∑–¥–∞–Ω–æ: 2025-12-07*
*–û–±–Ω–æ–≤–ª–µ–Ω–æ: 2025-12-10 ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π*
