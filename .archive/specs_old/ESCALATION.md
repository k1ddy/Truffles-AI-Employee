# ะกะะะฆะะคะะะะฆะะฏ ะญะกะะะะะฆะะ TRUFFLES

**ะะฐัะฐ:** 2025-12-06
**ะกัะฐััั:** ะะะะขะะงะะกะะะ ะะะะฃะะะะข
**ะะฒัะพั:** ะะฐะฝะฑะพะป + Droid

> โ๏ธ **ะญัะบะฐะปะฐัะธั โ ะฒัะพัะพะน ััะพะปะฟ ะฟัะพะตะบัะฐ ะฟะพัะปะต ะผะพะทะณะพะฒ ะฑะพัะฐ.**
> ะะตะท ััะพะณะพ Active Learning ะฝะต ัะฐะฑะพัะฐะตั. ะะพั ะฝะต ััะธััั. ะัะพะดัะบั ะผัััะฒ.

---

## ะะะงะะ ะญะขะะข ะะะะฃะะะะข

ะญัะบะฐะปะฐัะธั โ ััะพ **ะฟัะพะดัะบั ะฒะฝัััะธ ะฟัะพะดัะบัะฐ**:
- ะกะธััะตะผะฐ ัะฒะตะดะพะผะปะตะฝะธะน
- ะะฝัะตััะตะนั ะผะตะฝะตะดะถะตัะฐ
- ะะฝัะตััะตะนั ะผะพะดะตัะฐัะธะธ
- Pipeline ะพะฑััะตะฝะธั
- ะะตััะธะบะธ

**ะฆะตะปั:** ะะฐะถะดะฐั ััะบะฐะปะฐัะธั = ะฒะพะทะผะพะถะฝะพััั ะฝะฐััะธัั ะฑะพัะฐ. Escalation Rate ะฟะฐะดะฐะตั ัะพ ะฒัะตะผะตะฝะตะผ.

---

# ะงะะกะขะฌ 1: ะกะะกะขะะฏะะะฏ ะะะะะะะ

## ะะพะณะดะฐ ะณะพะฒะพัะธั ะฑะพั, ะบะพะณะดะฐ ัะตะปะพะฒะตะบ?

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ะกะะกะขะะฏะะะฏ ะะะะะะะ                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                 โ
โ  BOT_ACTIVE โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โ
โ      โ                                                    โ     โ
โ      โ ะะพั ะฝะต ะทะฝะฐะตั                                       โ     โ
โ      โผ                                                    โ     โ
โ  ESCALATED โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ     โ
โ      โ                                                โ   โ     โ
โ      โ ะะตะฝะตะดะถะตั ะฑะตััั ัะฟัะฐะฒะปะตะฝะธะต                      โ   โ     โ
โ      โผ                                                โ   โ     โ
โ  HUMAN_ACTIVE โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค   โ     โ
โ      โ                                                โ   โ     โ
โ      โ ะะตะฝะตะดะถะตั ะทะฐะฒะตััะธะป                              โ   โ     โ
โ      โผ                                                โ   โ     โ
โ  BOT_ACTIVE โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ     โ
โ                                                           โ     โ
โ                                                           โ     โ
โ  BOT_ACTIVE โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค     โ
โ      โ                                                    โ     โ
โ      โ ะะปะธะตะฝั ะฟัะพัะธั ัะตะปะพะฒะตะบะฐ                             โ     โ
โ      โผ                                                    โ     โ
โ  HUMAN_REQUESTED โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ     โ
โ      โ                                                โ   โ     โ
โ      โ ะะพั: "ะะตัะตะดะฐะป ะผะตะฝะตะดะถะตัั" + ะพะดะฝะฐ ะฟะพะฟััะบะฐ ะฟะพะผะพัั โ   โ     โ
โ      โผ                                                โ   โ     โ
โ  HUMAN_ACTIVE (ะฑะพั ะผะพะปัะธั 24ั ะธะปะธ ะดะพ "ะฒะตัะฝััั ะฑะพัั")  โ   โ     โ
โ      โ                                                โ   โ     โ
โ      โ ะะตะฝะตะดะถะตั ะทะฐะฒะตััะธะป ะะะ 24ั ะฟัะพัะปะพ               โ   โ     โ
โ      โผ                                                โ   โ     โ
โ  BOT_ACTIVE โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ     โ
โ                                                           โ     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โ
```

---

## ะขะฐะฑะปะธัะฐ ัะพััะพัะฝะธะน

| ะกะพััะพัะฝะธะต | ะัะพ ะพัะฒะตัะฐะตั | ะะพั ะดะตะปะฐะตั | ะขัะธะณะณะตั ะฒััะพะดะฐ |
|-----------|--------------|------------|----------------|
| `bot_active` | ะะพั | ะัะฒะตัะฐะตั ะฝะฐ ะฒัั | โ |
| `escalated` | ะะดัะผ ะผะตะฝะตะดะถะตัะฐ | ะฃะถะต ะพัะฒะตัะธะป ะบะปะธะตะฝัั, ะถะดัั | ะะตะฝะตะดะถะตั ะพัะฒะตัะธะป / timeout |
| `human_requested` | ะะดัะผ ะผะตะฝะตะดะถะตัะฐ | ะะดะฝะฐ ะฟะพะฟััะบะฐ ะฟะพะผะพัั, ะฟะพัะพะผ ะผะพะปัะธั | ะะตะฝะตะดะถะตั ะฟะพะดะบะปััะธะปัั |
| `human_active` | ะะตะฝะตะดะถะตั | **ะะะะงะะข** | ะะตะฝะตะดะถะตั ะฝะฐะถะฐะป "ะะตัะฝััั ะฑะพัั" |
| `pending_answer` | ะะธะบัะพ | ะกะบะฐะทะฐะป "ััะตะฑัะตััั ะฒัะตะผั" | ะะพะปััะตะฝ ะพัะฒะตั |

---

## ะัะฐะฒะธะปะฐ ะฟะพะฒะตะดะตะฝะธั ะฑะพัะฐ

### ะะพะณะดะฐ `bot_active`:
- ะะพั ะพัะฒะตัะฐะตั ะฝะฐ ะฒัะต ัะพะพะฑัะตะฝะธั
- ะะพัะผะฐะปัะฝะฐั ัะฐะฑะพัะฐ

### ะะพะณะดะฐ `escalated`:
- ะะพั ะฃะะ ะพัะฒะตัะธะป ะบะปะธะตะฝัั (acknowledgment)
- ะะดัั ะฟะพะบะฐ ะผะตะฝะตะดะถะตั ะฒะพะทัะผัั ะธะปะธ ะพัะฒะตัะธั
- ะัะปะธ ะบะปะธะตะฝั ะฟะธัะตั ะตัั โ ะฑะพั ะพัะฒะตัะฐะตั ะบะฐะบ ะพะฑััะฝะพ (ะฝะต ะฑะปะพะบะธััะตััั)

### ะะพะณะดะฐ `human_requested`:
- ะะปะธะตะฝั ัะฐะผ ะฟะพะฟัะพัะธะป ัะตะปะพะฒะตะบะฐ
- ะะพั: "ะะตัะตะดะฐะป ะผะตะฝะตะดะถะตัั. ะะพะณั ะปะธ ั ะฟะพะบะฐ ัะตะผ-ัะพ ะฟะพะผะพัั?"
- ะัะปะธ ะบะปะธะตะฝั ัะฝะพะฒะฐ "ะฝะตั" / "ะผะตะฝะตะดะถะตั" โ ะฑะพั ะผะพะปัะธั
- ะะตัะตัะพะด ะฒ `human_active`

### ะะพะณะดะฐ `human_active`:
- **ะะะข ะะะะะะกะขะฌะฎ ะะะะงะะข**
- ะัะต ัะพะพะฑัะตะฝะธั ะบะปะธะตะฝัะฐ ะฒะธะดะธั ัะพะปัะบะพ ะผะตะฝะตะดะถะตั
- ะะตะฝะตะดะถะตั ะพัะฒะตัะฐะตั ะฝะฐะฟััะผัั
- ะะพั ะฒะธะดะธั ะฟะตัะตะฟะธัะบั (ะดะปั ะบะพะฝัะตะบััะฐ)
- ะััะพะด: ะผะตะฝะตะดะถะตั ะฝะฐะถะธะผะฐะตั "ะะตัะฝััั ะฑะพัั"

### ะะพะณะดะฐ `pending_answer`:
- ะะธะบัะพ ะฝะต ะพัะฒะตัะธะป ะฒ ัะตะฟะพัะบะต ััะบะฐะปะฐัะธะธ
- ะะพั ัะบะฐะทะฐะป: "ะะฐั ะฒะพะฟัะพั ััะตะฑัะตั ะดะพะฟะพะปะฝะธัะตะปัะฝะพะณะพ ะฒัะตะผะตะฝะธ. ะะฑัะทะฐัะตะปัะฝะพ ะฒะตัะฝััั ั ะพัะฒะตัะพะผ."
- ะกะพะทะดะฐะฝะฐ ะทะฐะดะฐัะฐ ะดะปั ะบะพะผะฐะฝะดั
- ะะพั ะผะพะปัะธั ะฟะพะบะฐ ะฝะต ะฟะพะปััะธั ะพัะฒะตั
- ะะพัะปะต ะฟะพะปััะตะฝะธั ะพัะฒะตัะฐ โ ะฑะพั ัะฐะผ ะพัะฒะตัะฐะตั ะบะปะธะตะฝัั

---

# ะงะะกะขะฌ 2: ะฆะะะะงะะ ะญะกะะะะะฆะะ

## ะัะพ ะพัะฒะตัะฐะตั ะธ ะบะพะณะดะฐ

```
ะญะกะะะะะฆะะฏ ะะะงะะะะกะฌ
        โ
        โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 1. PRIMARY MANAGER                    โ
โ    ะฃะฒะตะดะพะผะปะตะฝะธะต ะฒ Telegram             โ
โ    ะขะฐะนะผะฐัั: 5 ะผะธะฝัั                   โ
โโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
                โ ะะต ะพัะฒะตัะธะป
                โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 2. OTHER MANAGERS (ะฒัะต ะฒ ัะฟะธัะบะต)      โ
โ    ะฃะฒะตะดะพะผะปะตะฝะธะต ะฒัะตะผ                   โ
โ    ะขะฐะนะผะฐัั: 5 ะผะธะฝัั                   โ
โโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
                โ ะะธะบัะพ ะฝะต ะพัะฒะตัะธะป
                โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 3. LEADERSHIP (ะฒะปะฐะดะตะปะตั/ะดะธัะตะบัะพั)     โ
โ    ะัะฐัะฝัะน ะฐะปะตัั                      โ
โ    ะขะฐะนะผะฐัั: 10 ะผะธะฝัั                  โ
โโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
                โ ะะธะบัะพ ะฝะต ะพัะฒะตัะธะป
                โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 4. BOT FALLBACK                       โ
โ    "ะขัะตะฑัะตััั ะฒัะตะผั, ะฒะตัะฝััั"         โ
โ    ะกะพะทะดะฐัั ะทะฐะดะฐัั ะฒ ัะธััะตะผะต           โ
โ    status = 'pending_answer'          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ะขะฐะนะผะฐััั (ะฝะฐัััะฐะธะฒะฐะตะผัะต)

| ะฃัะพะฒะตะฝั | ะะพ ัะผะพะปัะฐะฝะธั | ะะพะถะฝะพ ะธะทะผะตะฝะธัั |
|---------|--------------|----------------|
| Primary Manager | 5 ะผะธะฝ | ะะฐ |
| Other Managers | 5 ะผะธะฝ | ะะฐ |
| Leadership | 10 ะผะธะฝ | ะะฐ |
| **ะะฑัะธะน ัะฐะนะผะฐัั** | **20 ะผะธะฝ** | ะะฐ |

---

# ะงะะกะขะฌ 3: ะะะะ ะ ะะะะะะฅะะฏ

## ะะพะปะธ ะฒ ัะธััะตะผะต

| ะะพะปั | ะัะพ | ะัะฐะฒะฐ | ะัะฒะตั ะฒ KB |
|------|-----|-------|------------|
| `owner` | ะะปะฐะดะตะปะตั ะฑะธะทะฝะตัะฐ | ะัั | ะะฒัะพะผะฐัะธัะตัะบะธ (ะทะพะปะพัะพ) |
| `admin` | ะฃะฟัะฐะฒะปัััะธะน | ะะพััะธ ะฒัั | ะะพัะปะต ะผะพะดะตัะฐัะธะธ owner |
| `manager` | ะะตะฝะตะดะถะตั | ะัะฒะตัะฐัั, ะฒะธะดะตัั ะดะธะฐะปะพะณะธ | ะะพัะปะต ะผะพะดะตัะฐัะธะธ |
| `support` | ะะพะดะดะตัะถะบะฐ | ะขะพะปัะบะพ ะพัะฒะตัะฐัั | ะะพัะปะต ะผะพะดะตัะฐัะธะธ |

---

## ะงะตะน ะพัะฒะตั โ ะทะพะปะพัะพ?

```
Owner ะพัะฒะตัะธะป โ ััะฐะทั ะฒ KB (ะฑะตะท ะผะพะดะตัะฐัะธะธ)
Admin ะพัะฒะตัะธะป โ ะผะพะดะตัะฐัะธั owner (ะธะปะธ ะฐะฒัะพ ัะตัะตะท 24ั)
Manager ะพัะฒะตัะธะป โ ะผะพะดะตัะฐัะธั admin/owner
Support ะพัะฒะตัะธะป โ ะผะพะดะตัะฐัะธั admin/owner
```

**ะะฐัััะพะนะบะฐ:** ะะฐะบะฐะทัะธะบ ะฒัะฑะธัะฐะตั ะบัะพ ะธะผะตะตั "ะทะพะปะพัะพะน" ััะฐััั.

---

## ะะพััะดะพะบ ััะบะฐะปะฐัะธะธ (ะฝะฐัััะฐะธะฒะฐะตะผัะน)

```sql
-- ะขะฐะฑะปะธัะฐ: escalation_chain
client_id | priority | role      | user_id | contact
----------|----------|-----------|---------|------------------
1         | 1        | manager   | 101     | @manager_tg
1         | 2        | manager   | 102     | @manager2_tg
1         | 3        | admin     | 103     | @admin_tg
1         | 4        | owner     | 104     | @owner_tg
```

---

# ะงะะกะขะฌ 4: ะะะ ะะะะะะะะ ะะขะะะงะะะข

## ะะฐัะธะฐะฝัั (ะทะฐะบะฐะทัะธะบ ะฒัะฑะธัะฐะตั)

### ะะฐัะธะฐะฝั A: Telegram ะฑะพั
```
ะะตะฝะตะดะถะตั ะฟะพะปััะฐะตั ะฒ Telegram:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐จ ะะะะะฏ ะญะกะะะะะฆะะฏ                  โ
โ                                     โ
โ ๐ฑ ะะปะธะตะฝั: +7 701 570 5555          โ
โ ๐ฌ ะะพะฟัะพั: "ะกะบะพะปัะบะพ ััะพะธั ะฝะฐ 3      โ
โ    ะฝะพะผะตัะฐ ั Kaspi ะธะฝัะตะณัะฐัะธะตะน?"     โ
โ                                     โ
โ ๐ค ะะพั ะดัะผะฐะป: "ะะปะธะตะฝั ัะฟัะฐัะธะฒะฐะตั    โ
โ    ะบะฐััะพะผะฝัะน ะฟะฐะบะตั, ะฝะตั ะฒ ะฑะฐะทะต"     โ
โ                                     โ
โ ๐ ะััะพัะธั:                         โ
โ ะ: ะัะธะฒะตั                           โ
โ ะ: ะะดัะฐะฒััะฒัะนัะต! ะงะตะผ ะผะพะณั ะฟะพะผะพัั?   โ
โ ะ: ะัะถะตะฝ ะฑะพั ะฝะฐ 3 ะฝะพะผะตัะฐ            โ
โ                                     โ
โ [ะัะฒะตัะธัั] [ะะทััั ะดะธะฐะปะพะณ] [ะะณะฝะพั]   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ะะตะฝะตะดะถะตั ะฝะฐะถะธะผะฐะตั [ะัะฒะตัะธัั]:
โ ะะฒะพะดะธั ัะตะบัั ะฒ Telegram
โ ะะพั ะฟะตัะตััะปะฐะตั ะฒ WhatsApp ะบะปะธะตะฝัั
โ ะะพั ัะพััะฐะฝัะตั ะดะปั ะพะฑััะตะฝะธั
```

### ะะฐัะธะฐะฝั B: ะะตะฑ-ะธะฝัะตััะตะนั
```
ะะตะฝะตะดะถะตั ะทะฐัะพะดะธั ะฝะฐ dashboard.truffles.kz:
- ะะธะดะธั ัะฟะธัะพะบ ััะบะฐะปะฐัะธะน
- ะะธะดะธั ะฟะพะปะฝัั ะธััะพัะธั ะดะธะฐะปะพะณะฐ
- ะัะฒะตัะฐะตั ะฒ ัะพัะผะต
- ะัะฒะตั ััะพะดะธั ะบะปะธะตะฝัั
```

### ะะฐัะธะฐะฝั C: ะััะผะพะน WhatsApp
```
ะะตะฝะตะดะถะตั ะฟะพะปััะฐะตั ัะฒะตะดะพะผะปะตะฝะธะต:
โ ะัะบััะฒะฐะตั WhatsApp Business
โ ะะฐัะพะดะธั ะบะปะธะตะฝัะฐ
โ ะัะฒะตัะฐะตั ะฝะฐะฟััะผัั
โ ะกะธััะตะผะฐ ะฒะธะดะธั ััะพ ะผะตะฝะตะดะถะตั ะพัะฒะตัะธะป (ะฟะพ ะฝะพะผะตัั)
โ ะะพะผะตัะฐะตั ััะบะฐะปะฐัะธั ะบะฐะบ resolved
```

**ะะตะบะพะผะตะฝะดะฐัะธั:** ะะฐัะฐัั ั Telegram (ะฑััััะตะต ะฒะฝะตะดัะธัั), ะฟะพัะพะผ ะดะพะฑะฐะฒะธัั ะฒะตะฑ.

---

## ะะพะฒะตะดะตะฝะธะต ะฑะพัะฐ ะบะพะณะดะฐ ะผะตะฝะตะดะถะตั ะฒ ะดะธะฐะปะพะณะต

### ะะตะฝะตะดะถะตั ะฝะฐะถะฐะป "ะะทััั ะดะธะฐะปะพะณ":
1. `conversation.status = 'human_active'`
2. ะะพั ะฟะพะปะฝะพัััั ะผะพะปัะธั
3. ะัะต ัะพะพะฑัะตะฝะธั ะบะปะธะตะฝัะฐ โ ะผะตะฝะตะดะถะตัั
4. ะะตะฝะตะดะถะตั ะพัะฒะตัะฐะตั ะฝะฐะฟััะผัั (ะธะปะธ ัะตัะตะท ะฑะพัะฐ)

### ะะตะฝะตะดะถะตั ะฝะฐะถะฐะป "ะะตัะฝััั ะฑะพัั":
1. `conversation.status = 'bot_active'`
2. ะะพั ะฟัะพะดะพะปะถะฐะตั ั ะฟะพะปะฝัะผ ะบะพะฝัะตะบััะพะผ
3. ะะพั: "ะกะฟะฐัะธะฑะพ ะทะฐ ะพะถะธะดะฐะฝะธะต! ะงะตะผ ะตัั ะผะพะณั ะฟะพะผะพัั?"

### ะะตะฝะตะดะถะตั ะฟัะพััะพ ะพัะฒะตัะธะป (ะฝะต ะฑัะฐะป ะดะธะฐะปะพะณ):
1. ะัะฒะตั ััะพะดะธั ะบะปะธะตะฝัั
2. ะะพั ะพััะฐัััั ะฐะบัะธะฒะฝัะผ
3. ะกะปะตะดัััะตะต ัะพะพะฑัะตะฝะธะต ะบะปะธะตะฝัะฐ โ ะฑะพัั

---

# ะงะะกะขะฌ 5: ะะะะะะะฆะะฏ ะ ะะะฃะงะะะะ

## ะัะพ ะผะพะดะตัะธััะตั?

**ะะฐะบะฐะทัะธะบ ัะฐะผ**, ั ะฟะพะผะพััั Truffles ะฝะฐ ััะฐััะต.

### ะะตัะฒัะน ะผะตััั:
- Truffles ะฟะพะผะพะณะฐะตั ะฝะฐัััะพะธัั
- ะะพะบะฐะทัะฒะฐะตั ะบะฐะบ ะผะพะดะตัะธัะพะฒะฐัั
- ะัะพะฒะตััะตั ะบะฐัะตััะฒะพ

### ะะพัะปะต:
- ะะฐะบะฐะทัะธะบ ะผะพะดะตัะธััะตั ัะฐะผ
- Owner/Admin ะธะผะตัั ะดะพัััะฟ ะบ ะธะฝัะตััะตะนัั ะผะพะดะตัะฐัะธะธ

---

## ะะฝัะตััะตะนั ะผะพะดะตัะฐัะธะธ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะะะะะะะฆะะฏ ะะขะะะขะะ                              [ะกะตะณะพะดะฝั โผ]  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                             โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ โ ะะพะฟัะพั ะบะปะธะตะฝัะฐ:                                         โ โ
โ โ "ะกะบะพะปัะบะพ ััะพะธั ะฟะพะดะบะปััะธัั 3 ะฝะพะผะตัะฐ ั Kaspi?"            โ โ
โ โ                                                         โ โ
โ โ ะัะฒะตั ะผะตะฝะตะดะถะตัะฐ (ะะนะณัะปั):                               โ โ
โ โ "ะะปั 3 ะฝะพะผะตัะพะฒ ะฟะพะดะพะนะดัั ัะฐัะธั Pro ะทะฐ 150,000 ัะณ.        โ โ
โ โ  Kaspi Pay ะฒะบะปัััะฝ. ะฅะพัะธัะต ะพัะพัะผะธัั?"                   โ โ
โ โ                                                         โ โ
โ โ [โ ะะพะฑะฐะฒะธัั ะฒ ะฑะฐะทั] [โ๏ธ ะะตะดะฐะบัะธัะพะฒะฐัั] [โ ะัะบะปะพะฝะธัั]  โ โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                             โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ โ ะะพะฟัะพั ะบะปะธะตะฝัะฐ:                                         โ โ
โ โ "ะ ะผะพะถะฝะพ ัะฐัััะพัะบั?"                                    โ โ
โ โ                                                         โ โ
โ โ ะัะฒะตั ะผะตะฝะตะดะถะตัะฐ (ะะพะปะฐั):                                โ โ
โ โ "ะะฐ, ะผะพะถะฝะพ ัะตัะตะท Kaspi Red ะฝะฐ 3 ะผะตัััะฐ"                 โ โ
โ โ                                                         โ โ
โ โ [โ ะะพะฑะฐะฒะธัั ะฒ ะฑะฐะทั] [โ๏ธ ะะตะดะฐะบัะธัะพะฒะฐัั] [โ ะัะบะปะพะฝะธัั]  โ โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                             โ
โ ะกัะฐัะธััะธะบะฐ:                                                 โ
โ โข ะะถะธะดะฐัั ะผะพะดะตัะฐัะธะธ: 5                                      โ
โ โข ะะพะฑะฐะฒะปะตะฝะพ ัะตะณะพะดะฝั: 12                                     โ
โ โข ะัะบะปะพะฝะตะฝะพ: 2                                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ะะฒัะพะผะพะดะตัะฐัะธั (ะดะปั owner)

ะัะปะธ ะพัะฒะตัะธะป ัะตะปะพะฒะตะบ ั ัะพะปัั `owner`:
```
โ ะัะฒะตั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะดะพะฑะฐะฒะปัะตััั ะฒ KB
โ ะะตะท ัััะฝะพะน ะผะพะดะตัะฐัะธะธ
โ ะะพะณะธััะตััั: "ะะพะฑะฐะฒะปะตะฝะพ ะฐะฒัะพะผะฐัะธัะตัะบะธ (owner)"
```

ะะฐัััะพะนะบะฐ: ะผะพะถะฝะพ ะฒะบะปััะธัั ะฐะฒัะพะผะพะดะตัะฐัะธั ะดะปั `admin` ัะพะถะต.

---

## ะคะพัะผะฐั ะทะฝะฐะฝะธะน ะธะท ััะบะฐะปะฐัะธะธ

```json
{
  "type": "escalation_learning",
  "question": "ะกะบะพะปัะบะพ ััะพะธั ะฝะฐ 3 ะฝะพะผะตัะฐ ั Kaspi?",
  "answer": "ะะปั 3 ะฝะพะผะตัะพะฒ ะฟะพะดะพะนะดัั ัะฐัะธั Pro ะทะฐ 150,000 ัะณ. Kaspi Pay ะฒะบะปัััะฝ.",
  "context": {
    "client_intent": "pricing_custom",
    "conversation_history": ["...", "..."],
    "escalation_reason": "ะะตั ัะพัะฝะพะณะพ ะพัะฒะตัะฐ ะฒ ะฑะฐะทะต"
  },
  "metadata": {
    "answered_by": "ะะนะณัะปั",
    "answered_by_role": "manager",
    "moderated_by": "Owner",
    "moderated_at": "2025-12-06T10:30:00Z",
    "source": "escalation"
  }
}
```

---

## ะะตะดัะฟะปะธะบะฐัะธั

ะะตัะตะด ะดะพะฑะฐะฒะปะตะฝะธะตะผ ะฒ KB:
1. Semantic search ะฟะพ ะฒะพะฟัะพัั
2. ะัะปะธ similarity > 0.9 โ ะฟะพะบะฐะทะฐัั: "ะะพัะพะถะธะน ะฒะพะฟัะพั ัะถะต ะตััั. ะะฑะฝะพะฒะธัั?"
3. ะะฐัะธะฐะฝัั: [ะะพะฑะฐะฒะธัั ะบะฐะบ ะฝะพะฒัะน] [ะะฑะฝะพะฒะธัั ัััะตััะฒัััะธะน] [ะัะพะฟัััะธัั]

---

# ะงะะกะขะฌ 6: ะะะขะะะะ

## Dashboard ะดะปั ะทะฐะบะฐะทัะธะบะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะญะกะะะะะฆะะ                                    ะะตะบะฐะฑัั 2025   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                             โ
โ  Escalation Rate     โโโโโโโโโโโโโโโโ  32%                 โ
โ  (ัะตะปั: <20%)        โ ะฑัะปะพ 45% ะผะตััั ะฝะฐะทะฐะด                โ
โ                                                             โ
โ  ะกัะตะดะฝะตะต ะฒัะตะผั ะพัะฒะตัะฐ ะผะตะฝะตะดะถะตัะฐ: 4.2 ะผะธะฝ                   โ
โ  (ัะตะปั: <5 ะผะธะฝ)                                            โ
โ                                                             โ
โ  ะะพะฑะฐะฒะปะตะฝะพ ะฒ ะฑะฐะทั ะทะฝะฐะฝะธะน: 47 ะพัะฒะตัะพะฒ                       โ
โ  ะะถะธะดะฐัั ะผะพะดะตัะฐัะธะธ: 3                                       โ
โ                                                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ะขะะ ะฟัะธัะธะฝ ััะบะฐะปะฐัะธะธ:                                      โ
โ  1. ะะฐััะพะผะฝัะต ัะฐัะธัั (34%)                                  โ
โ  2. ะขะตัะฝะธัะตัะบะธะต ะฒะพะฟัะพัั (28%)                               โ
โ  3. ะะฐะปะพะฑั (18%)                                            โ
โ  4. ะะพะทะฒัะฐัั (12%)                                          โ
โ  5. ะัะพัะตะต (8%)                                             โ
โ                                                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ะขัะตะฝะด ััะบะฐะปะฐัะธะน:                                           โ
โ                                                             โ
โ  50% โ    โญโโโฎ                                              โ
โ  40% โ โโโโฏ  โฐโโโฎ                                           โ
โ  30% โ          โฐโโโฎ                                        โ
โ  20% โ              โฐโโโโ                                   โ
โ  10% โ                                                      โ
โ      โโโโโโโโโโโโโโโโโโโโโโโโโโ                             โ
โ        ะะตะด1  ะะตะด2  ะะตะด3  ะะตะด4                               โ
โ                                                             โ
โ  โ ะะพั ะพะฑััะฐะตััั! -13% ะทะฐ ะผะตััั                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ะะปััะตะฒัะต ะผะตััะธะบะธ

| ะะตััะธะบะฐ | ะคะพัะผัะปะฐ | ะฆะตะปั |
|---------|---------|------|
| Escalation Rate | ะญัะบะฐะปะฐัะธะธ / ะัะต ะดะธะฐะปะพะณะธ | <20% ัะตัะตะท 2 ะผะตั |
| Response Time | ะัะตะผั ะดะพ ะพัะฒะตัะฐ ะผะตะฝะตะดะถะตัะฐ | <5 ะผะธะฝ |
| Resolution Rate | ะะตััะฝะฝัะต / ะัะต ััะบะฐะปะฐัะธะธ | >95% |
| Learning Rate | ะะพะฑะฐะฒะปะตะฝะพ ะฒ KB / ะญัะบะฐะปะฐัะธะธ | >50% |
| False Escalation | ะัะฒะตั ะฑัะป ะฒ KB / ะญัะบะฐะปะฐัะธะธ | <10% |

---

# ะงะะกะขะฌ 7: ะะะะ ะะะะะซะฅ

## ะขะฐะฑะปะธัั

### escalations
```sql
CREATE TABLE escalations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  conversation_id UUID REFERENCES conversations(id),
  client_id UUID REFERENCES clients(id),
  
  -- ะงัะพ ะฟัะพะธะทะพัะปะพ
  trigger_type TEXT NOT NULL,  -- 'bot_uncertain', 'client_request', 'complaint', 'timeout'
  question TEXT NOT NULL,
  bot_thinking TEXT,
  context JSONB,  -- ะธััะพัะธั ะดะธะฐะปะพะณะฐ
  
  -- ะฆะตะฟะพัะบะฐ ััะบะฐะปะฐัะธะธ
  escalation_level INT DEFAULT 1,  -- 1=primary, 2=others, 3=leadership, 4=fallback
  notified_users JSONB,  -- ะบะพะผั ะพัะฟัะฐะฒะธะปะธ ัะฒะตะดะพะผะปะตะฝะธั
  
  -- ะัะฒะตั
  status TEXT DEFAULT 'pending',  -- pending, answered, timeout, resolved
  answered_by UUID REFERENCES users(id),
  answered_at TIMESTAMP,
  answer TEXT,
  
  -- ะะพะดะตัะฐัะธั
  moderation_status TEXT,  -- pending, approved, rejected, auto_approved
  moderated_by UUID,
  moderated_at TIMESTAMP,
  added_to_kb BOOLEAN DEFAULT FALSE,
  kb_document_id TEXT,  -- ID ะฒ Qdrant
  
  -- ะะตัะฐ
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_escalations_client ON escalations(client_id);
CREATE INDEX idx_escalations_status ON escalations(status);
CREATE INDEX idx_escalations_moderation ON escalations(moderation_status);
```

### escalation_chain
```sql
CREATE TABLE escalation_chain (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  client_id UUID REFERENCES clients(id),
  priority INT NOT NULL,  -- ะฟะพััะดะพะบ ัะฒะตะดะพะผะปะตะฝะธั
  user_id UUID REFERENCES users(id),
  role TEXT NOT NULL,  -- owner, admin, manager, support
  contact_type TEXT NOT NULL,  -- telegram, whatsapp, email
  contact_value TEXT NOT NULL,  -- @username, +77771234567
  timeout_minutes INT DEFAULT 5,
  is_active BOOLEAN DEFAULT TRUE,
  
  UNIQUE(client_id, priority)
);
```

### conversation updates
```sql
ALTER TABLE conversations ADD COLUMN IF NOT EXISTS
  status TEXT DEFAULT 'bot_active';  -- bot_active, escalated, human_requested, human_active, pending_answer

ALTER TABLE conversations ADD COLUMN IF NOT EXISTS
  human_operator_id UUID REFERENCES users(id);

ALTER TABLE conversations ADD COLUMN IF NOT EXISTS
  escalated_at TIMESTAMP;

ALTER TABLE conversations ADD COLUMN IF NOT EXISTS
  human_active_since TIMESTAMP;
```

---

# ะงะะกะขะฌ 8: EDGE CASES

## ะงัะพ ะตัะปะธ...

| ะกะธััะฐัะธั | ะงัะพ ะดะตะปะฐะตะผ |
|----------|------------|
| ะะปะธะตะฝั ะฟะธัะตั ะฟะพะบะฐ ะถะดัะผ ะผะตะฝะตะดะถะตัะฐ | ะะพั ะพัะฒะตัะฐะตั ะบะฐะบ ะพะฑััะฝะพ (ะตัะปะธ ะผะพะถะตั) |
| ะะปะธะตะฝั ะฟะธัะตั ะบะพะณะดะฐ ะผะตะฝะตะดะถะตั ะฒ ะดะธะฐะปะพะณะต | ะกะพะพะฑัะตะฝะธะต ะธะดัั ะผะตะฝะตะดะถะตัั, ะฑะพั ะผะพะปัะธั |
| ะะตะฝะตะดะถะตั ะพัะฒะตัะธะป ะฟะพัะปะต ัะฐะนะผะฐััะฐ | ะัะฒะตั ะฒัั ัะฐะฒะฝะพ ะพัะฟัะฐะฒะปัะตััั + ะผะพะดะตัะฐัะธั |
| ะะฒะฐ ะผะตะฝะตะดะถะตัะฐ ะพัะฒะตัะธะปะธ ะพะดะฝะพะฒัะตะผะตะฝะฝะพ | ะะตัะฒัะน ะพัะฒะตั ะธะดัั ะบะปะธะตะฝัั, ะฒัะพัะพะน ะฒ ะปะพะณ |
| ะะปะธะตะฝั ัััะป (ะฝะต ะพัะฒะตัะฐะตั) | ะะฐะบัััั ััะบะฐะปะฐัะธั ัะตัะตะท 24ั |
| ะัะฒะตั ะผะตะฝะตะดะถะตัะฐ โ ััะนะฝั | ะะพะดะตัะฐัะพั ะพัะบะปะพะฝัะตั, ะฝะต ะธะดัั ะฒ KB |
| ะะพั ััะบะฐะปะธัะพะฒะฐะป ะทัั (ะพัะฒะตั ะฑัะป ะฒ KB) | ะะพะผะตัะธัั ะบะฐะบ false_escalation, ัะปัััะธัั RAG |
| ะะปะธะตะฝั ะฒะตัะฝัะปัั ัะตัะตะท ะดะตะฝั | ะะพั ะฒะธะดะธั pending_answer, ััะฐะทั ะพัะฒะตัะฐะตั |

---

## Fallback ัะพะพะฑัะตะฝะธั

```
ESCALATION (ะฑะพั ะบะปะธะตะฝัั):
"ะฅะพัะพัะธะน ะฒะพะฟัะพั! ะฃัะพัะฝั ั ะบะพะปะปะตะณ ะธ ะฒะตัะฝััั ั ัะพัะฝัะผ ะพัะฒะตัะพะผ."

HUMAN_REQUESTED (ะฑะพั ะบะปะธะตะฝัั):
"ะะตัะตะดะฐะป ะฒะฐั ะฒะพะฟัะพั ะผะตะฝะตะดะถะตัั. ะะพะณั ะปะธ ั ะฟะพะบะฐ ัะตะผ-ัะพ ะฟะพะผะพัั?"

HUMAN_REQUESTED + "ะฝะตั" (ะฑะพั ะบะปะธะตะฝัั):
"ะะพะฝัะป! ะะตะฝะตะดะถะตั ัะฒัะถะตััั ั ะฒะฐะผะธ ะฒ ะฑะปะธะถะฐะนัะตะต ะฒัะตะผั."
[ะฑะพั ะผะพะปัะธั]

TIMEOUT FALLBACK (ะฑะพั ะบะปะธะตะฝัั):
"ะะฐั ะฒะพะฟัะพั ััะตะฑัะตั ะดะพะฟะพะปะฝะธัะตะปัะฝะพะณะพ ะฒัะตะผะตะฝะธ. ะะฑัะทะฐัะตะปัะฝะพ ะฒะตัะฝััั ั ะพัะฒะตัะพะผ ะฒ ัะตัะตะฝะธะต ะดะฝั."

PENDING_ANSWER RESOLVED (ะฑะพั ะบะปะธะตะฝัั):
"ะะพะฑััะน ะดะตะฝั! ะะตัะฝัะปัั ั ะพัะฒะตัะพะผ ะฝะฐ ะฒะฐั ะฒะพะฟัะพั: [ะพัะฒะตั]"
```

---

# ะงะะกะขะฌ 9: ะะะะ ะะะะะะะะฆะะ

## ะคะฐะทะฐ 1: ะะธะฝะธะผัะผ ะดะปั ัะฐะฑะพัั (1 ะฝะตะดะตะปั)

- [ ] ะขะฐะฑะปะธัะฐ `escalations` ะฒ ะะ
- [ ] ะกัะฐัััั ะฒ `conversations`
- [ ] Telegram ะฑะพั ะดะปั ัะฒะตะดะพะผะปะตะฝะธะน (ะฟัะพััะพะน)
- [ ] ะะฝะพะฟะบะฐ "ะัะฒะตัะธัั" โ ะพัะฒะตั ะบะปะธะตะฝัั
- [ ] ะคะธะบั workflow: needs_escalation โ ะพัะฒะตั + ัะฒะตะดะพะผะปะตะฝะธะต

## ะคะฐะทะฐ 2: ะฆะตะฟะพัะบะฐ ััะบะฐะปะฐัะธะธ (1 ะฝะตะดะตะปั)

- [ ] ะขะฐะฑะปะธัะฐ `escalation_chain`
- [ ] ะขะฐะนะผะฐััั ะธ ััะพะฒะฝะธ
- [ ] Fallback "ััะตะฑัะตััั ะฒัะตะผั"
- [ ] ะฃะฒะตะดะพะผะปะตะฝะธะต ะฒัะตะผ ะผะตะฝะตะดะถะตัะฐะผ

## ะคะฐะทะฐ 3: Human takeover (1 ะฝะตะดะตะปั)

- [ ] ะะฝะพะฟะบะฐ "ะะทััั ะดะธะฐะปะพะณ"
- [ ] ะะพั ะผะพะปัะธั ะบะพะณะดะฐ human_active
- [ ] ะะฝะพะฟะบะฐ "ะะตัะฝััั ะฑะพัั"
- [ ] ะกะธะฝััะพะฝะธะทะฐัะธั ัะพััะพัะฝะธะน

## ะคะฐะทะฐ 4: ะะพะดะตัะฐัะธั ะธ KB (2 ะฝะตะดะตะปะธ)

- [ ] ะะฝัะตััะตะนั ะผะพะดะตัะฐัะธะธ (ะฒะตะฑ)
- [ ] ะะพะฑะฐะฒะปะตะฝะธะต ะฒ Qdrant
- [ ] ะะฒัะพะผะพะดะตัะฐัะธั ะดะปั owner
- [ ] ะะตะดัะฟะปะธะบะฐัะธั

## ะคะฐะทะฐ 5: ะะตััะธะบะธ (1 ะฝะตะดะตะปั)

- [ ] Dashboard ััะบะฐะปะฐัะธะน
- [ ] ะขัะตะฝะดั
- [ ] ะะปะตััั (escalation rate ัะฐัััั)

---

# ะงะะกะขะฌ 10: ะะะคะะะขะซ ะ ะะะะคะะะฃะะะฆะะฏ

> โ๏ธ **ะะะะะฆะะ:** ะั ะฝะต ัะตัะฐะตะผ ะทะฐ ะทะฐะบะฐะทัะธะบะฐ. ะั ะดะฐัะผ ัะผะฝัะต ะดะตัะพะปัั ั ะพะฑัััะฝะตะฝะธะตะผ.
> ะะฐะบะฐะทัะธะบ ะผะตะฝัะตั ะฟะพะด ัะตะฑั. ะัั ะดะพะปะถะฝะพ ะปะตะณะบะพ ะฝะฐัััะฐะธะฒะฐัััั.

---

## ะะะะคะะะฃะะะะฃะะะซะ ะะะะะะะขะะซ

### ะขะฐะนะผะฐััั ััะบะฐะปะฐัะธะธ

| ะะฐัะฐะผะตัั | ะะตัะพะปั | ะะพัะตะผั | ะะฐัััะพะนะบะฐ |
|----------|--------|--------|-----------|
| `primary_timeout` | 5 ะผะธะฝ | ะััะปะตะดะพะฒะฐะฝะธั: 80% ะผะตะฝะตะดะถะตัะพะฒ ะพัะฒะตัะฐัั ะทะฐ 3-5 ะผะธะฝ ะตัะปะธ ะพะฝะปะฐะนะฝ | โ ะบะปะธะตะฝั ะผะตะฝัะตั |
| `others_timeout` | 5 ะผะธะฝ | ะะฐัะผ ัะฐะฝั ะดััะณะธะผ, ะฝะพ ะฝะต ะทะฐััะณะธะฒะฐะตะผ | โ ะบะปะธะตะฝั ะผะตะฝัะตั |
| `leadership_timeout` | 10 ะผะธะฝ | ะัะบะพะฒะพะดััะฒะพ ะผะพะถะตั ะฑััั ะทะฐะฝััะพ, ะฝะพ ะฒะพะฟัะพั ะบัะธัะธัะฝัะน | โ ะบะปะธะตะฝั ะผะตะฝัะตั |
| `total_timeout` | 20 ะผะธะฝ | ะะพัะปะต 20 ะผะธะฝ ะบะปะธะตะฝั ัะถะต ัะฐะทะดัะฐะถัะฝ โ ะปัััะต ัะตััะฝะพ ัะบะฐะทะฐัั "ะฝัะถะฝะพ ะฒัะตะผั" | โ ะบะปะธะตะฝั ะผะตะฝัะตั |

**ะััะพัะฝะธะบ ะดะตัะพะปัะพะฒ:** Zendesk benchmark โ ััะตะดะฝะตะต ะฒัะตะผั ะฟะตัะฒะพะณะพ ะพัะฒะตัะฐ ะฒ ัะฐัะฐั 5-7 ะผะธะฝ, ะปัััะธะต ะบะพะผะฟะฐะฝะธะธ <3 ะผะธะฝ.

---

### ะะฒัะพะผะพะดะตัะฐัะธั

| ะะฐัะฐะผะตัั | ะะตัะพะปั | ะะพัะตะผั | ะะฐัััะพะนะบะฐ |
|----------|--------|--------|-----------|
| `owner_auto_approve` | โ ะะฐ | Owner = ะฒะปะฐะดะตะปะตั ะฑะธะทะฝะตัะฐ, ะตะณะพ ัะปะพะฒะพ โ ะทะฐะบะพะฝ | โ ะบะปะธะตะฝั ะผะตะฝัะตั |
| `admin_auto_approve` | โ ะะตั | Admin ะผะพะถะตั ะพัะธะฑะธัััั, ะปัััะต owner ะฟัะพะฒะตัะธั | โ ะบะปะธะตะฝั ะผะตะฝัะตั |
| `auto_approve_delay` | 24ั | ะัะปะธ owner ะฝะต ะพัะบะปะพะฝะธะป ะทะฐ 24ั โ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฒ KB | โ ะบะปะธะตะฝั ะผะตะฝัะตั |

**ะะพะณะธะบะฐ:** ะะฐัะธะฝะฐะตะผ ะบะพะฝัะตัะฒะฐัะธะฒะฝะพ (ัะพะปัะบะพ owner ะฐะฒัะพ). ะัะปะธ ะทะฐะบะฐะทัะธะบ ะดะพะฒะตััะตั admin โ ะฒะบะปััะฐะตั ัะฐะผ.

---

### ะะฐะฝะฐะปั ัะฒะตะดะพะผะปะตะฝะธะน

| ะะฐัะฐะผะตัั | ะะตัะพะปั | ะะพัะตะผั | ะะฐัััะพะนะบะฐ |
|----------|--------|--------|-----------|
| `notification_channel` | Telegram | ะััััะตะต ะฒัะตะณะพ, push-ัะฒะตะดะพะผะปะตะฝะธั, ะบะฝะพะฟะบะธ | โ ะบะปะธะตะฝั ะฒัะฑะธัะฐะตั |
| `response_channel` | ะงะตัะตะท ะฑะพัะฐ | ะะดะธะฝะฐั ัะพัะบะฐ, ะฒัั ะปะพะณะธััะตััั | โ ะบะปะธะตะฝั ะฒัะฑะธัะฐะตั |
| `fallback_channel` | WhatsApp direct | ะัะปะธ Telegram ะฝะต ัะฐะฑะพัะฐะตั | โ ะบะปะธะตะฝั ะผะตะฝัะตั |

**ะะปััะตัะฝะฐัะธะฒั:** Telegram / WhatsApp / Email / Web push โ ะทะฐะบะฐะทัะธะบ ะฒัะฑะธัะฐะตั ััะพ ัะดะพะฑะฝะตะต ะบะพะผะฐะฝะดะต.

---

### ะะพัะฝะพะน ัะตะถะธะผ

| ะะฐัะฐะผะตัั | ะะตัะพะปั | ะะพัะตะผั | ะะฐัััะพะนะบะฐ |
|----------|--------|--------|-----------|
| `quiet_hours_enabled` | โ ะะฐ | ะะต ะฑัะดะธัั ะปัะดะตะน ะฝะพััั | โ ะบะปะธะตะฝั ะผะตะฝัะตั |
| `quiet_hours_start` | 23:00 | ะะพะปััะธะฝััะฒะพ ัะฟะธั | โ ะบะปะธะตะฝั ะผะตะฝัะตั |
| `quiet_hours_end` | 08:00 | ะะฐัะฐะปะพ ัะฐะฑะพัะตะณะพ ะดะฝั | โ ะบะปะธะตะฝั ะผะตะฝัะตั |
| `quiet_hours_behavior` | `queue` | ะะพะฟะธะผ ััะบะฐะปะฐัะธะธ, ัััะพะผ ะพัะฟัะฐะฒะปัะตะผ ะฟะฐัะบะพะน | โ ะบะปะธะตะฝั ะฒัะฑะธัะฐะตั |

**ะะฐัะธะฐะฝัั quiet_hours_behavior:**
- `queue` โ ะบะพะฟะธะผ, ัััะพะผ ะพัะฟัะฐะฒะปัะตะผ (ะดะตัะพะปั)
- `notify_anyway` โ ะฑัะดะธะผ (ะดะปั ะบัะธัะธัะฝัั ะฑะธะทะฝะตัะพะฒ: ะผะตะดะธัะธะฝะฐ, ะดะพััะฐะฒะบะฐ)
- `bot_only` โ ะฑะพั ะพัะฒะตัะฐะตั ัะฐะผ, ััะบะฐะปะฐัะธะธ ัััะพะผ

---

### ะะธะผะธัั

| ะะฐัะฐะผะตัั | ะะตัะพะปั | ะะพัะตะผั | ะะฐัััะพะนะบะฐ |
|----------|--------|--------|-----------|
| `max_escalations_per_hour` | 50 | ะะฐัะธัะฐ ะพั ัะฟะฐะผะฐ/DDoS | โ ะบะปะธะตะฝั ะผะตะฝัะตั |
| `escalation_cooldown` | 1 ะผะธะฝ | ะะดะธะฝ ะบะปะธะตะฝั ะฝะต ะผะพะถะตั ัะฟะฐะผะธัั ััะบะฐะปะฐัะธัะผะธ | โ ะบะปะธะตะฝั ะผะตะฝัะตั |
| `alert_threshold` | 20/ัะฐั | ะัะปะธ ะฑะพะปััะต โ ะฐะปะตัั ะฒะปะฐะดะตะปััั "ััะพ-ัะพ ะฝะต ัะฐะบ" | โ ะบะปะธะตะฝั ะผะตะฝัะตั |

**ะัะธ ะฟัะตะฒััะตะฝะธะธ ะปะธะผะธัะฐ:** ะะพั ะฟัะพะดะพะปะถะฐะตั ะพัะฒะตัะฐัั ะบะฐะบ ะผะพะถะตั, ะฝะพ ะฝะต ัะฟะฐะผะธั ะผะตะฝะตะดะถะตัะพะฒ. ะะปะฐะดะตะปะตั ะฟะพะปััะฐะตั ะฐะปะตัั.

---

### ะะพะฒะตะดะตะฝะธะต ะฑะพัะฐ

| ะะฐัะฐะผะตัั | ะะตัะพะปั | ะะพัะตะผั | ะะฐัััะพะนะบะฐ |
|----------|--------|--------|-----------|
| `human_silence_duration` | 24ั | ะคะธะปะพัะพัะธั "ะฝะตั ะทะฝะฐัะธั ะฝะตั" | โ ะบะปะธะตะฝั ะผะตะฝัะตั |
| `escalation_message` | "ะฃัะพัะฝั ั ะบะพะปะปะตะณ..." | ะะตะนััะฐะปัะฝะพะต, ะฝะต ะฟัะณะฐะตั ะบะปะธะตะฝัะฐ | โ ะบะปะธะตะฝั ัะตะดะฐะบัะธััะตั |
| `pending_message` | "ะขัะตะฑัะตััั ะฒัะตะผั..." | ะงะตััะฝะพ, ั ะพะฑะตัะฐะฝะธะตะผ ะฒะตัะฝััััั | โ ะบะปะธะตะฝั ัะตะดะฐะบัะธััะตั |
| `return_message` | "ะะตัะฝัะปัั ั ะพัะฒะตัะพะผ..." | ะะพะบะฐะทัะฒะฐะตั ััะพ ะฝะต ะทะฐะฑัะปะธ | โ ะบะปะธะตะฝั ัะตะดะฐะบัะธััะตั |

---

## ะะะขะะะคะะะก ะะะกะขะะะะ (ะดะปั ะทะฐะบะฐะทัะธะบะฐ)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะะะกะขะะะะะ ะญะกะะะะะฆะะ                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                             โ
โ โฑ๏ธ ะขะะะะะฃะขะซ                                                 โ
โ                                                             โ
โ ะะตัะฒัะน ะผะตะฝะตะดะถะตั:     [5] ะผะธะฝัั     โ "ะกะบะพะปัะบะพ ะถะดะฐัั ะพัะฒะตัะฐ" โ
โ ะััะฐะปัะฝัะต ะผะตะฝะตะดะถะตัั: [5] ะผะธะฝัั                              โ
โ ะัะบะพะฒะพะดััะฒะพ:         [10] ะผะธะฝัั                             โ
โ ะะฐะบัะธะผัะผ ะพะถะธะดะฐะฝะธั:   [20] ะผะธะฝัั                             โ
โ                                                             โ
โ ๐ ะะะงะะะ ะะะะะ                                             โ
โ                                                             โ
โ [โ] ะะบะปััะธัั ัะธัะธะต ัะฐัั                                     โ
โ ะก [23:00] ะดะพ [08:00]                                        โ
โ ะะพะฒะตะดะตะฝะธะต: [ะะพะฟะธัั ะดะพ ัััะฐ โผ]                               โ
โ                                                             โ
โ โ ะะะขะะะะะะะะฆะะฏ                                            โ
โ                                                             โ
โ [โ] ะัะฒะตัั ะฒะปะฐะดะตะปััะฐ โ ััะฐะทั ะฒ ะฑะฐะทั ะทะฝะฐะฝะธะน                  โ
โ [ ] ะัะฒะตัั ะฐะดะผะธะฝะพะฒ โ ััะฐะทั ะฒ ะฑะฐะทั ะทะฝะฐะฝะธะน                    โ
โ ะะฒัะพ-ะพะดะพะฑัะตะฝะธะต ัะตัะตะท: [24] ัะฐัะฐ                             โ
โ                                                             โ
โ ๐ฌ ะกะะะะฉะะะะฏ ะะะขะ                                           โ
โ                                                             โ
โ ะัะธ ััะบะฐะปะฐัะธะธ:                                              โ
โ [ะฅะพัะพัะธะน ะฒะพะฟัะพั! ะฃัะพัะฝั ั ะบะพะปะปะตะณ ะธ ะฒะตัะฝััั ั ะพัะฒะตัะพะผ.    ]  โ
โ                                                             โ
โ ะัะปะธ ะดะพะปะณะพ ะฝะตั ะพัะฒะตัะฐ:                                      โ
โ [ะะฐั ะฒะพะฟัะพั ััะตะฑัะตั ะฒัะตะผะตะฝะธ. ะะฑัะทะฐัะตะปัะฝะพ ะฒะตัะฝััั ัะตะณะพะดะฝั.]  โ
โ                                                             โ
โ                                      [ะกะพััะฐะฝะธัั ะธะทะผะตะฝะตะฝะธั]  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ะะะะะฆะะ ะะะะะะะะะ

```
ะะฐะบะฐะทัะธะบ ัะบะฐะทะฐะป "5 ะผะธะฝัั ะผะฐะปะพ, ั ะฝะฐั ะผะตะฝะตะดะถะตัั ะผะตะดะปะตะฝะฝัะต"
     โ
ะะฐัะพะดะธั ะฒ ะฝะฐัััะพะนะบะธ โ ะผะตะฝัะตั ะฝะฐ 10 ะผะธะฝัั
     โ
ะัะธะผะตะฝัะตััั ะกะะะะฃ (ะฑะตะท ะฟะตัะตะทะฐะฟััะบะฐ, ะฑะตะท ะฝะฐั)
     โ
ะงะตัะตะท ะฝะตะดะตะปั: "10 ะผะธะฝัั ะผะฝะพะณะพ, ะบะปะธะตะฝัั ััะพะดัั"
     โ
ะะตะฝัะตั ะพะฑัะฐัะฝะพ ะฝะฐ 5 ะผะธะฝัั
     โ
ะัะธะผะตะฝัะตััั ะกะะะะฃ
```

**ะั ะะ ััะฐััะฒัะตะผ ะฒ ะธะทะผะตะฝะตะฝะธะธ ะฟะฐัะฐะผะตััะพะฒ.** ะะฐะบะฐะทัะธะบ ัะฐะผ.
**ะั ะฟะพะผะพะณะฐะตะผ** ัะพะปัะบะพ ะตัะปะธ ะทะฐะบะฐะทัะธะบ ะฝะต ะฟะพะฝะธะผะฐะตั ััะพ ะฝะฐัััะพะธัั.

---

## ะะะะคะะ ะ ะะะะ ะะะะะซะฅ

```sql
CREATE TABLE client_settings (
  client_id UUID PRIMARY KEY REFERENCES clients(id),
  
  -- ะขะฐะนะผะฐััั (ะฒ ะผะธะฝััะฐั)
  primary_timeout INT DEFAULT 5,
  others_timeout INT DEFAULT 5,
  leadership_timeout INT DEFAULT 10,
  total_timeout INT DEFAULT 20,
  
  -- ะะฒัะพะผะพะดะตัะฐัะธั
  owner_auto_approve BOOLEAN DEFAULT TRUE,
  admin_auto_approve BOOLEAN DEFAULT FALSE,
  auto_approve_delay_hours INT DEFAULT 24,
  
  -- ะะพัะฝะพะน ัะตะถะธะผ
  quiet_hours_enabled BOOLEAN DEFAULT TRUE,
  quiet_hours_start TIME DEFAULT '23:00',
  quiet_hours_end TIME DEFAULT '08:00',
  quiet_hours_behavior TEXT DEFAULT 'queue',  -- queue, notify_anyway, bot_only
  
  -- ะะธะผะธัั
  max_escalations_per_hour INT DEFAULT 50,
  escalation_cooldown_seconds INT DEFAULT 60,
  alert_threshold_per_hour INT DEFAULT 20,
  
  -- ะะพะฒะตะดะตะฝะธะต
  human_silence_hours INT DEFAULT 24,
  
  -- ะกะพะพะฑัะตะฝะธั (JSON ะดะปั ะผัะปััะธัะทััะฝะพััะธ)
  messages JSONB DEFAULT '{
    "escalation": "ะฅะพัะพัะธะน ะฒะพะฟัะพั! ะฃัะพัะฝั ั ะบะพะปะปะตะณ ะธ ะฒะตัะฝััั ั ะพัะฒะตัะพะผ.",
    "pending": "ะะฐั ะฒะพะฟัะพั ััะตะฑัะตั ะดะพะฟะพะปะฝะธัะตะปัะฝะพะณะพ ะฒัะตะผะตะฝะธ. ะะฑัะทะฐัะตะปัะฝะพ ะฒะตัะฝััั ั ะพัะฒะตัะพะผ.",
    "return": "ะะตัะฝัะปัั ั ะพัะฒะตัะพะผ ะฝะฐ ะฒะฐั ะฒะพะฟัะพั:"
  }',
  
  updated_at TIMESTAMP DEFAULT NOW()
);

-- ะะฝะดะตะบั ะดะปั ะฑััััะพะณะพ ะดะพัััะฟะฐ
CREATE INDEX idx_client_settings ON client_settings(client_id);
```

---

## ะะะคะะะขะซ ะะ ะะะจะะ (ะฟัะตัะตัั)

| ะะธัะฐ | ะขะฐะนะผะฐััั | ะะพัะฝะพะน ัะตะถะธะผ | ะัะพะฑะตะฝะฝะพััะธ |
|------|----------|--------------|-------------|
| **ะกะฐะปะพะฝ ะบัะฐัะพัั** | 5/5/10 | 23:00-09:00, queue | ะกัะฐะฝะดะฐัั |
| **ะะพะฝะดะธัะตััะบะฐั** | 3/5/10 | 22:00-08:00, queue | ะกัะพัะฝัะต ะทะฐะบะฐะทั |
| **ะะพััะฐะฒะบะฐ ะตะดั** | 2/3/5 | ะัะบะป (24/7) | ะัะธัะธัะฝะพ ะฑััััะพ |
| **ะะตะดะธัะธะฝะฐ** | 3/5/10 | ะัะบะป (24/7) | ะัะธัะธัะฝะพ ะฒัะตะณะดะฐ |
| **ะะฐะณะฐะทะธะฝ ะพะดะตะถะดั** | 5/10/15 | 22:00-10:00, queue | ะะตะฝะตะต ััะพัะฝะพ |

**ะัะธ ะพะฝะฑะพัะดะธะฝะณะต:** "ะั ัะฐะปะพะฝ ะบัะฐัะพัั? ะะพั ัะตะบะพะผะตะฝะดัะตะผัะต ะฝะฐัััะพะนะบะธ. ะะพะถะตัะต ะธะทะผะตะฝะธัั."

---

*ะกะพะทะดะฐะฝะพ: 2025-12-06*
*ะะฑะฝะพะฒะปััั ะฟัะธ ะธะทะผะตะฝะตะฝะธัั*
*ะญัะพ ะถะธะฒะพะน ะดะพะบัะผะตะฝั โ ะดะพะฟะพะปะฝััั ะฟะพ ะผะตัะต ัะตะฐะปะธะทะฐัะธะธ*
