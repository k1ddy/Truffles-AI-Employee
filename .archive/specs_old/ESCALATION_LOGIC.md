# ЛОГИКА ЭСКАЛАЦИИ И МЬЮТА

---

## СОСТОЯНИЯ

```
bot_active → pending → manager_active → bot_active
```

| Состояние | Бот | Сообщения |
|-----------|-----|-----------|
| bot_active | Отвечает | — |
| pending | Помогает пока ждёт | Форвардятся в Telegram |
| manager_active | МОЛЧИТ | Форвардятся в Telegram |

---

## ПЕРЕХОДЫ

| Из | Триггер | В | Действие |
|----|---------|---|----------|
| bot_active | "позови менеджера" | pending | Создать заявку, отправить в Telegram |
| pending | Менеджер [Беру] | manager_active | — |
| manager_active | Менеджер [Решено] | bot_active | Закрыть заявку |
| pending | Клиент "нет/забей" | bot_active | Закрыть заявку (клиент отменил) |
| manager_active | Клиент "нет/забей" | bot_active | Закрыть заявку (клиент отменил) |

---

## МЬЮТ (только в bot_active)

| Ситуация | Действие |
|----------|----------|
| Первый "нет" в bot_active | Мьют 30 мин |
| Второй "нет" в bot_active | Мьют 24 часа |
| 24 часа без сообщений | Сброс мьюта |

**ВАЖНО:** "нет" при открытой заявке (pending/manager_active) — это НЕ мьют, это отмена заявки.

---

## НАПОМИНАНИЯ

| Время | Действие |
|-------|----------|
| 30 мин | Reminder 1: "Заявка ждёт" |
| 60 мин | Reminder 2: "СРОЧНО" + тег @ent3rprise |
| 2 часа | Уведомить клиента: "Менеджеры заняты, перезвоните..." |

**Auto-close НЕТ** — заявка висит пока менеджер не закроет.

---

## TODO

- [ ] "нет" при pending/active → закрыть заявку, бот активен
- [ ] Reminder 3 (2 часа) → уведомить клиента
- [ ] История переписки в заявке
- [ ] Автоприветствие менеджера
- [ ] "Менеджер уже занимается" при повторном вопросе

---

*Создано: 2025-12-10*
